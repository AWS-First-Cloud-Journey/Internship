{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{Link}from'react-router-dom';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Messages=()=>{const[conversations,setConversations]=useState([]);const[selectedConversation,setSelectedConversation]=useState(null);const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState('');const[replyTo,setReplyTo]=useState(null);const[loading,setLoading]=useState(true);const[showAppointmentModal,setShowAppointmentModal]=useState(false);const[conversationAppointments,setConversationAppointments]=useState([]);const[searchUsers,setSearchUsers]=useState('');const[sending,setSending]=useState(false);const[selectedImages,setSelectedImages]=useState([]);const messagesEndRef=useRef(null);const fileInputRef=useRef(null);useEffect(()=>{fetchConversations();// Auto-refresh conversations list every 2 seconds\nconst conversationInterval=setInterval(()=>{fetchConversations();},2000);return()=>clearInterval(conversationInterval);},[]);// Real-time user search effect\nuseEffect(()=>{const timeoutId=setTimeout(()=>{fetchConversations();},300);return()=>clearTimeout(timeoutId);},[searchUsers]);useEffect(()=>{if(selectedConversation){fetchMessages(selectedConversation.id);markMessagesAsRead(selectedConversation.id);fetchConversationAppointments(selectedConversation.id);// Much faster refresh for messages (every 1 second)\nconst messageInterval=setInterval(()=>{fetchMessages(selectedConversation.id);markMessagesAsRead(selectedConversation.id);},1000);// Slower refresh for appointments (every 5 seconds)\nconst appointmentInterval=setInterval(()=>{fetchConversationAppointments(selectedConversation.id);},5000);return()=>{clearInterval(messageInterval);clearInterval(appointmentInterval);};}},[selectedConversation]);useEffect(()=>{scrollToBottom();},[messages]);const scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});};// Auto-scroll when new messages arrive\nuseEffect(()=>{const timer=setTimeout(()=>{scrollToBottom();},100);return()=>clearTimeout(timer);},[messages.length]);const fetchConversations=async()=>{try{const token=localStorage.getItem('token');const params=searchUsers?`?search=${encodeURIComponent(searchUsers)}`:'';const response=await axios.get(`/api/conversations${params}`,{headers:{'Authorization':`Bearer ${token}`}});setConversations(response.data);}catch(error){console.error('Error fetching conversations:',error);}finally{setLoading(false);}};const handleUserSearch=()=>{fetchConversations();};const fetchMessages=async conversationId=>{try{const token=localStorage.getItem('token');const response=await axios.get(`/api/conversations/${conversationId}/messages`,{headers:{'Authorization':`Bearer ${token}`}});setMessages(response.data);}catch(error){console.error('Error fetching messages:',error);}};const markMessagesAsRead=async conversationId=>{try{const token=localStorage.getItem('token');await axios.post(`/api/conversations/${conversationId}/mark-read`,{},{headers:{'Authorization':`Bearer ${token}`}});// Trigger navbar count update\nwindow.dispatchEvent(new Event('messageCountUpdate'));}catch(error){console.error('Error marking messages as read:',error);}};const fetchConversationAppointments=async conversationId=>{try{const token=localStorage.getItem('token');const response=await axios.get(`/api/conversations/${conversationId}/appointments`,{headers:{'Authorization':`Bearer ${token}`}});setConversationAppointments(response.data);}catch(error){console.error('Error fetching appointments:',error);}};const createAppointment=async appointmentData=>{try{const token=localStorage.getItem('token');await axios.post(`/api/conversations/${selectedConversation.id}/appointments`,appointmentData,{headers:{'Authorization':`Bearer ${token}`}});fetchConversationAppointments(selectedConversation.id);fetchMessages(selectedConversation.id);setShowAppointmentModal(false);}catch(error){console.error('Error creating appointment:',error);}};const handleImageSelect=e=>{const files=Array.from(e.target.files);const imageFiles=files.filter(file=>file.type.startsWith('image/'));const imagePromises=imageFiles.map(file=>{return new Promise(resolve=>{const reader=new FileReader();reader.onload=e=>{resolve({file:file,preview:e.target.result,id:Math.random().toString(36).substr(2,9)});};reader.readAsDataURL(file);});});Promise.all(imagePromises).then(images=>{setSelectedImages(prev=>[...prev,...images]);});// Clear file input\nif(fileInputRef.current)fileInputRef.current.value='';};const removeImage=imageId=>{setSelectedImages(prev=>prev.filter(img=>img.id!==imageId));};const sendMessage=async e=>{e.preventDefault();if(!newMessage.trim()&&selectedImages.length===0)return;if(sending)return;setSending(true);try{const token=localStorage.getItem('token');// Send text message if there's text\nif(newMessage.trim()){const textFormData=new FormData();textFormData.append('message_type','text');textFormData.append('content',newMessage);if(replyTo){textFormData.append('reply_to_id',replyTo.id);}await axios.post(`/api/conversations/${selectedConversation.id}/messages`,textFormData,{headers:{'Authorization':`Bearer ${token}`,'Content-Type':'multipart/form-data'}});}// Send each image separately\nfor(const image of selectedImages){const imageFormData=new FormData();imageFormData.append('file',image.file);imageFormData.append('message_type','image');imageFormData.append('content','');await axios.post(`/api/conversations/${selectedConversation.id}/messages`,imageFormData,{headers:{'Authorization':`Bearer ${token}`,'Content-Type':'multipart/form-data'}});}// Clear inputs immediately\nsetNewMessage('');setReplyTo(null);setSelectedImages([]);// Immediately fetch new messages\nfetchMessages(selectedConversation.id);window.dispatchEvent(new Event('messageCountUpdate'));}catch(error){console.error('Error sending message:',error);}finally{setSending(false);}};const editMessage=async(messageId,newContent)=>{try{const token=localStorage.getItem('token');await axios.put(`/api/messages/${messageId}`,{content:newContent},{headers:{'Authorization':`Bearer ${token}`}});fetchMessages(selectedConversation.id);}catch(error){console.error('Error editing message:',error);}};const deleteMessage=async messageId=>{try{const token=localStorage.getItem('token');await axios.delete(`/api/messages/${messageId}`,{headers:{'Authorization':`Bearer ${token}`}});fetchMessages(selectedConversation.id);}catch(error){console.error('Error deleting message:',error);}};const shareLocation=()=>{if(navigator.geolocation){navigator.geolocation.getCurrentPosition(async position=>{try{const token=localStorage.getItem('token');await axios.post(`/api/conversations/${selectedConversation.id}/messages`,{message_type:'location',location_lat:position.coords.latitude,location_lng:position.coords.longitude,location_name:'Current Location'},{headers:{'Authorization':`Bearer ${token}`}});fetchMessages(selectedConversation.id);}catch(error){console.error('Error sharing location:',error);}});}};const MessageBubble=_ref=>{let{message,isOwn}=_ref;const[isEditing,setIsEditing]=useState(false);const[editContent,setEditContent]=useState(message.content);const currentUser=JSON.parse(localStorage.getItem('user'));// System messages (appointment notifications)\nif(message.message_type==='system'){return/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center',marginBottom:'1rem'},children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'#f0f8ff',color:'#666',padding:'0.5rem 1rem',borderRadius:'12px',fontSize:'0.9rem',border:'1px solid #e0e8f0'},children:[message.content,/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'0.7rem',opacity:0.7,marginTop:'0.25rem',textAlign:'center'},children:new Date(message.created_at).toLocaleTimeString()})]})});}return/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:isOwn?'flex-end':'flex-start',marginBottom:'1rem'},children:/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:'70%',background:isOwn?'linear-gradient(135deg, #667eea 0%, #764ba2 100%)':'#f1f1f1',color:isOwn?'white':'black',padding:'0.75rem 1rem',borderRadius:'18px',position:'relative'},children:[message.reply_to&&/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(0,0,0,0.1)',padding:'0.5rem',borderRadius:'8px',marginBottom:'0.5rem',fontSize:'0.8rem',borderLeft:'3px solid rgba(255,255,255,0.5)'},children:[/*#__PURE__*/_jsxs(\"strong\",{children:[message.reply_to.sender_username,\":\"]}),/*#__PURE__*/_jsx(\"div\",{children:message.reply_to.content})]}),message.message_type==='image'&&message.file_url&&/*#__PURE__*/_jsx(\"img\",{src:`/api/uploads/${message.file_url}`,alt:\"Shared image\",style:{maxWidth:'200px',borderRadius:'8px',marginBottom:'0.5rem'}}),message.message_type==='location'&&message.location&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'0.5rem'},children:[\"\\uD83D\\uDCCD \",/*#__PURE__*/_jsx(\"strong\",{children:message.location.name}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"small\",{children:[\"Lat: \",message.location.lat,\", Lng: \",message.location.lng]})]}),isEditing?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{value:editContent,onChange:e=>setEditContent(e.target.value),style:{width:'100%',padding:'0.25rem',marginBottom:'0.5rem'}}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{editMessage(message.id,editContent);setIsEditing(false);},style:{marginRight:'0.5rem',fontSize:'0.7rem'},children:\"Save\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsEditing(false),style:{fontSize:'0.7rem'},children:\"Cancel\"})]})]}):/*#__PURE__*/_jsxs(\"div\",{children:[message.content,message.is_edited&&/*#__PURE__*/_jsx(\"small\",{style:{opacity:0.7},children:\" (edited)\"})]}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'0.7rem',opacity:0.7,marginTop:'0.25rem'},children:new Date(message.created_at).toLocaleTimeString()}),isOwn&&message.sender_id===currentUser.id&&!message.is_deleted&&/*#__PURE__*/_jsxs(\"div\",{style:{position:'absolute',top:'-10px',right:'0',display:'none'},className:\"message-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setReplyTo(message),style:{fontSize:'0.6rem',margin:'0 2px'},children:\"Reply\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsEditing(true),style:{fontSize:'0.6rem',margin:'0 2px'},children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>deleteMessage(message.id),style:{fontSize:'0.6rem',margin:'0 2px'},children:\"Delete\"})]})]})});};if(loading)return/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',padding:'2rem'},children:\"Loading...\"});return/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:'1200px',margin:'0 auto',padding:'2rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center',marginBottom:'3rem'},children:[/*#__PURE__*/_jsx(Link,{to:\"/\",style:{color:'white',textDecoration:'none',padding:'0.75rem 1.5rem',background:'linear-gradient(135deg, #ff6b6b 0%, #feca57 100%)',borderRadius:'12px',fontWeight:'500',transition:'all 0.3s ease',marginRight:'2rem',boxShadow:'0 4px 15px rgba(255, 107, 107, 0.4)'},children:\"\\u2190 Home\"}),/*#__PURE__*/_jsx(\"h2\",{style:{fontSize:'2.5rem',fontWeight:'700',background:'linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3)',WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent',backgroundSize:'400% 400%',animation:'rainbow 3s ease-in-out infinite'},children:\"Messages\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',height:'600px',background:'rgba(255, 255, 255, 0.95)',borderRadius:'16px',overflow:'hidden'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{width:'300px',borderRight:'1px solid #eee',overflow:'auto'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:'1rem',borderBottom:'1px solid #eee'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{marginBottom:'1rem'},children:\"Conversations\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search users...\",value:searchUsers,onChange:e=>setSearchUsers(e.target.value),style:{width:'100%',padding:'0.5rem',border:'1px solid #ddd',borderRadius:'8px',fontSize:'0.9rem'}})]}),conversations.map(conv=>{var _conv$last_message$co;return/*#__PURE__*/_jsxs(\"div\",{onClick:()=>setSelectedConversation(conv),style:{padding:'1rem',borderBottom:'1px solid #f0f0f0',cursor:'pointer',background:(selectedConversation===null||selectedConversation===void 0?void 0:selectedConversation.id)===conv.id?'#f0f8ff':'transparent',position:'relative'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:conv.unread_count>0?'bold':'normal'},children:conv.other_user.username}),conv.unread_count>0&&/*#__PURE__*/_jsx(\"span\",{style:{backgroundColor:'#e74c3c',color:'white',borderRadius:'50%',width:'20px',height:'20px',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'0.7rem',fontWeight:'bold'},children:conv.unread_count})]}),conv.item&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'0.8rem',color:'#666'},children:[\"About: \",conv.item.name]}),conv.last_message&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'0.8rem',color:conv.unread_count>0?'#333':'#999',marginTop:'0.25rem',fontWeight:conv.unread_count>0?'500':'normal'},children:[(_conv$last_message$co=conv.last_message.content)===null||_conv$last_message$co===void 0?void 0:_conv$last_message$co.substring(0,50),\"...\"]})]},conv.id);})]}),/*#__PURE__*/_jsx(\"div\",{style:{flex:1,display:'flex',flexDirection:'column'},children:selectedConversation?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:'1rem',borderBottom:'1px solid #eee',background:'#f8f9fa'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'0.5rem'},children:[/*#__PURE__*/_jsx(\"h4\",{children:selectedConversation.other_user.username}),/*#__PURE__*/_jsx(\"div\",{style:{width:'8px',height:'8px',borderRadius:'50%',background:'#2ecc71',animation:'pulse 2s infinite'}})]}),selectedConversation.item&&/*#__PURE__*/_jsxs(\"small\",{children:[\"Discussing: \",selectedConversation.item.name]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowAppointmentModal(true),style:{background:'#f39c12',color:'white',border:'none',padding:'0.5rem 1rem',borderRadius:'8px',cursor:'pointer',fontSize:'0.9rem'},children:\"\\uD83D\\uDCC5 Schedule\"})]}),conversationAppointments.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'1rem',padding:'0.75rem',background:'#e8f4fd',borderRadius:'8px'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'0.9rem',fontWeight:'bold',marginBottom:'0.5rem'},children:\"Appointments:\"}),conversationAppointments.map(apt=>/*#__PURE__*/_jsxs(\"div\",{onClick:()=>window.location.href='/appointments',style:{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'0.5rem',background:'white',borderRadius:'6px',marginBottom:'0.25rem',cursor:'pointer',fontSize:'0.8rem'},children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\uD83D\\uDCC5 \",new Date(apt.appointment_time).toLocaleDateString(),\" at \",new Date(apt.appointment_time).toLocaleTimeString()]}),/*#__PURE__*/_jsx(\"span\",{style:{background:apt.status==='confirmed'?'#2ecc71':apt.status==='pending'?'#f39c12':'#e74c3c',color:'white',padding:'0.2rem 0.5rem',borderRadius:'12px',fontSize:'0.7rem'},children:apt.status})]},apt.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,padding:'1rem',overflow:'auto'},children:[messages.map(message=>/*#__PURE__*/_jsx(MessageBubble,{message:message,isOwn:message.sender_id===JSON.parse(localStorage.getItem('user')).id},message.id)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),selectedImages.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{padding:'1rem',borderTop:'1px solid #eee',background:'#f8f9fa'},children:[/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',gap:'0.5rem',flexWrap:'wrap',marginBottom:'0.5rem'},children:selectedImages.map(image=>/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative',display:'inline-block'},children:[/*#__PURE__*/_jsx(\"img\",{src:image.preview,alt:\"Preview\",style:{width:'80px',height:'80px',objectFit:'cover',borderRadius:'8px',border:'2px solid #e0e0e0'}}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeImage(image.id),style:{position:'absolute',top:'-5px',right:'-5px',width:'20px',height:'20px',borderRadius:'50%',background:'#e74c3c',color:'white',border:'none',cursor:'pointer',fontSize:'12px',display:'flex',alignItems:'center',justifyContent:'center'},children:\"\\u2715\"})]},image.id))}),/*#__PURE__*/_jsxs(\"small\",{style:{color:'#666'},children:[selectedImages.length,\" image(s) selected\"]})]}),replyTo&&/*#__PURE__*/_jsxs(\"div\",{style:{padding:'0.5rem 1rem',background:'#f0f8ff',borderTop:'1px solid #eee'},children:[/*#__PURE__*/_jsxs(\"small\",{children:[\"Replying to: \",replyTo.content]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setReplyTo(null),style:{float:'right',background:'none',border:'none'},children:\"\\u2715\"})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:sendMessage,style:{padding:'1rem',borderTop:'1px solid #eee',display:'flex',gap:'0.5rem'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",ref:fileInputRef,accept:\"image/*\",multiple:true,onChange:handleImageSelect,style:{display:'none'}}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{var _fileInputRef$current;return(_fileInputRef$current=fileInputRef.current)===null||_fileInputRef$current===void 0?void 0:_fileInputRef$current.click();},style:{padding:'0.5rem',background:'none',border:'none',cursor:'pointer',fontSize:'1.2rem'},children:\"\\uD83D\\uDCF7\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:shareLocation,style:{padding:'0.5rem'},children:\"\\uD83D\\uDCCD\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newMessage,onChange:e=>setNewMessage(e.target.value),placeholder:\"Type a message...\",style:{flex:1,padding:'0.75rem',border:'1px solid #ddd',borderRadius:'20px'}}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:sending||!newMessage.trim()&&selectedImages.length===0,style:{padding:'0.5rem 1rem',background:sending?'#95a5a6':!newMessage.trim()&&selectedImages.length===0?'#ddd':'#007bff',color:'white',border:'none',borderRadius:'20px',cursor:sending||!newMessage.trim()&&selectedImages.length===0?'not-allowed':'pointer',opacity:sending||!newMessage.trim()&&selectedImages.length===0?0.7:1,display:'flex',alignItems:'center',gap:'0.25rem'},children:sending?'Sending...':/*#__PURE__*/_jsxs(_Fragment,{children:[\"Send\",selectedImages.length>0&&/*#__PURE__*/_jsxs(\"span\",{style:{background:'rgba(255,255,255,0.3)',borderRadius:'10px',padding:'0.1rem 0.4rem',fontSize:'0.8rem'},children:[\"+\",selectedImages.length]})]})})]})]}):/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center',height:'100%'},children:/*#__PURE__*/_jsx(\"p\",{children:\"Select a conversation to start messaging\"})})})]}),/*#__PURE__*/_jsx(\"style\",{jsx:true,children:`\n        .message-actions {\n          display: none;\n        }\n        div:hover .message-actions {\n          display: block;\n        }\n        @keyframes pulse {\n          0% {\n            opacity: 1;\n            transform: scale(1);\n          }\n          50% {\n            opacity: 0.5;\n            transform: scale(1.2);\n          }\n          100% {\n            opacity: 1;\n            transform: scale(1);\n          }\n        }\n      `}),showAppointmentModal&&/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',top:0,left:0,right:0,bottom:0,backgroundColor:'rgba(0, 0, 0, 0.7)',display:'flex',justifyContent:'center',alignItems:'center',zIndex:1000},children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(255, 255, 255, 0.95)',backdropFilter:'blur(20px)',borderRadius:'24px',boxShadow:'0 20px 60px rgba(0,0,0,0.3)',border:'1px solid rgba(255, 255, 255, 0.2)',padding:'2rem',maxWidth:'500px',width:'90%'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{marginBottom:'1rem'},children:\"Schedule Appointment\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:e=>{e.preventDefault();const formData=new FormData(e.target);createAppointment({appointment_time:formData.get('appointment_time'),location:formData.get('location'),notes:formData.get('notes')});},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1rem'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'0.5rem'},children:\"Date & Time:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"datetime-local\",name:\"appointment_time\",min:new Date().toISOString().slice(0,16),style:{width:'100%',padding:'0.5rem',borderRadius:'4px',border:'1px solid #ddd'},required:true})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1rem'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'0.5rem'},children:\"Location:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"location\",placeholder:\"Meeting location\",style:{width:'100%',padding:'0.5rem',borderRadius:'4px',border:'1px solid #ddd'},required:true})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1rem'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'0.5rem'},children:\"Notes:\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"notes\",placeholder:\"Additional notes...\",rows:\"3\",style:{width:'100%',padding:'0.5rem',borderRadius:'4px',border:'1px solid #ddd'}})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'1rem'},children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowAppointmentModal(false),style:{flex:1,padding:'0.75rem',background:'#95a5a6',color:'white',border:'none',borderRadius:'8px'},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",style:{flex:1,padding:'0.75rem',background:'#f39c12',color:'white',border:'none',borderRadius:'8px'},children:\"Create Appointment\"})]})]})]})})]});};export default Messages;","map":{"version":3,"names":["React","useState","useEffect","useRef","Link","axios","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Messages","conversations","setConversations","selectedConversation","setSelectedConversation","messages","setMessages","newMessage","setNewMessage","replyTo","setReplyTo","loading","setLoading","showAppointmentModal","setShowAppointmentModal","conversationAppointments","setConversationAppointments","searchUsers","setSearchUsers","sending","setSending","selectedImages","setSelectedImages","messagesEndRef","fileInputRef","fetchConversations","conversationInterval","setInterval","clearInterval","timeoutId","setTimeout","clearTimeout","fetchMessages","id","markMessagesAsRead","fetchConversationAppointments","messageInterval","appointmentInterval","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","timer","length","token","localStorage","getItem","params","encodeURIComponent","response","get","headers","data","error","console","handleUserSearch","conversationId","post","window","dispatchEvent","Event","createAppointment","appointmentData","handleImageSelect","e","files","Array","from","target","imageFiles","filter","file","type","startsWith","imagePromises","map","Promise","resolve","reader","FileReader","onload","preview","result","Math","random","toString","substr","readAsDataURL","all","then","images","prev","value","removeImage","imageId","img","sendMessage","preventDefault","trim","textFormData","FormData","append","image","imageFormData","editMessage","messageId","newContent","put","content","deleteMessage","delete","shareLocation","navigator","geolocation","getCurrentPosition","position","message_type","location_lat","coords","latitude","location_lng","longitude","location_name","MessageBubble","_ref","message","isOwn","isEditing","setIsEditing","editContent","setEditContent","currentUser","JSON","parse","style","display","justifyContent","marginBottom","children","background","color","padding","borderRadius","fontSize","border","opacity","marginTop","textAlign","Date","created_at","toLocaleTimeString","maxWidth","reply_to","borderLeft","sender_username","file_url","src","alt","location","name","lat","lng","onChange","width","onClick","marginRight","is_edited","sender_id","is_deleted","top","right","className","margin","alignItems","to","textDecoration","fontWeight","transition","boxShadow","WebkitBackgroundClip","WebkitTextFillColor","backgroundSize","animation","height","overflow","borderRight","borderBottom","placeholder","conv","_conv$last_message$co","cursor","unread_count","other_user","username","backgroundColor","item","last_message","substring","flex","flexDirection","gap","apt","href","appointment_time","toLocaleDateString","status","ref","borderTop","flexWrap","objectFit","float","onSubmit","accept","multiple","_fileInputRef$current","click","disabled","left","bottom","zIndex","backdropFilter","formData","notes","min","toISOString","slice","required","rows"],"sources":["D:/Project/frontend/src/components/Messages.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { Link } from 'react-router-dom';\nimport axios from 'axios';\n\nconst Messages = () => {\n  const [conversations, setConversations] = useState([]);\n  const [selectedConversation, setSelectedConversation] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [replyTo, setReplyTo] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [showAppointmentModal, setShowAppointmentModal] = useState(false);\n  const [conversationAppointments, setConversationAppointments] = useState([]);\n  const [searchUsers, setSearchUsers] = useState('');\n  const [sending, setSending] = useState(false);\n  const [selectedImages, setSelectedImages] = useState([]);\n  const messagesEndRef = useRef(null);\n  const fileInputRef = useRef(null);\n\n  useEffect(() => {\n    fetchConversations();\n    \n    // Auto-refresh conversations list every 2 seconds\n    const conversationInterval = setInterval(() => {\n      fetchConversations();\n    }, 2000);\n    \n    return () => clearInterval(conversationInterval);\n  }, []);\n  \n  // Real-time user search effect\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      fetchConversations();\n    }, 300);\n    \n    return () => clearTimeout(timeoutId);\n  }, [searchUsers]);\n\n  useEffect(() => {\n    if (selectedConversation) {\n      fetchMessages(selectedConversation.id);\n      markMessagesAsRead(selectedConversation.id);\n      fetchConversationAppointments(selectedConversation.id);\n      \n      // Much faster refresh for messages (every 1 second)\n      const messageInterval = setInterval(() => {\n        fetchMessages(selectedConversation.id);\n        markMessagesAsRead(selectedConversation.id);\n      }, 1000);\n      \n      // Slower refresh for appointments (every 5 seconds)\n      const appointmentInterval = setInterval(() => {\n        fetchConversationAppointments(selectedConversation.id);\n      }, 5000);\n      \n      return () => {\n        clearInterval(messageInterval);\n        clearInterval(appointmentInterval);\n      };\n    }\n  }, [selectedConversation]);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n  \n  // Auto-scroll when new messages arrive\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      scrollToBottom();\n    }, 100);\n    return () => clearTimeout(timer);\n  }, [messages.length]);\n\n  const fetchConversations = async () => {\n    try {\n      const token = localStorage.getItem('token');\n      const params = searchUsers ? `?search=${encodeURIComponent(searchUsers)}` : '';\n      const response = await axios.get(`/api/conversations${params}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n      setConversations(response.data);\n    } catch (error) {\n      console.error('Error fetching conversations:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n  \n  const handleUserSearch = () => {\n    fetchConversations();\n  };\n\n  const fetchMessages = async (conversationId) => {\n    try {\n      const token = localStorage.getItem('token');\n      const response = await axios.get(`/api/conversations/${conversationId}/messages`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n      setMessages(response.data);\n    } catch (error) {\n      console.error('Error fetching messages:', error);\n    }\n  };\n  \n  const markMessagesAsRead = async (conversationId) => {\n    try {\n      const token = localStorage.getItem('token');\n      await axios.post(`/api/conversations/${conversationId}/mark-read`, {}, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n      // Trigger navbar count update\n      window.dispatchEvent(new Event('messageCountUpdate'));\n    } catch (error) {\n      console.error('Error marking messages as read:', error);\n    }\n  };\n  \n  const fetchConversationAppointments = async (conversationId) => {\n    try {\n      const token = localStorage.getItem('token');\n      const response = await axios.get(`/api/conversations/${conversationId}/appointments`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n      setConversationAppointments(response.data);\n    } catch (error) {\n      console.error('Error fetching appointments:', error);\n    }\n  };\n  \n  const createAppointment = async (appointmentData) => {\n    try {\n      const token = localStorage.getItem('token');\n      await axios.post(`/api/conversations/${selectedConversation.id}/appointments`, appointmentData, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n      fetchConversationAppointments(selectedConversation.id);\n      fetchMessages(selectedConversation.id);\n      setShowAppointmentModal(false);\n    } catch (error) {\n      console.error('Error creating appointment:', error);\n    }\n  };\n\n  const handleImageSelect = (e) => {\n    const files = Array.from(e.target.files);\n    const imageFiles = files.filter(file => file.type.startsWith('image/'));\n    \n    const imagePromises = imageFiles.map(file => {\n      return new Promise((resolve) => {\n        const reader = new FileReader();\n        reader.onload = (e) => {\n          resolve({\n            file: file,\n            preview: e.target.result,\n            id: Math.random().toString(36).substr(2, 9)\n          });\n        };\n        reader.readAsDataURL(file);\n      });\n    });\n    \n    Promise.all(imagePromises).then(images => {\n      setSelectedImages(prev => [...prev, ...images]);\n    });\n    \n    // Clear file input\n    if (fileInputRef.current) fileInputRef.current.value = '';\n  };\n  \n  const removeImage = (imageId) => {\n    setSelectedImages(prev => prev.filter(img => img.id !== imageId));\n  };\n  \n  const sendMessage = async (e) => {\n    e.preventDefault();\n    if (!newMessage.trim() && selectedImages.length === 0) return;\n    if (sending) return;\n\n    setSending(true);\n    try {\n      const token = localStorage.getItem('token');\n      \n      // Send text message if there's text\n      if (newMessage.trim()) {\n        const textFormData = new FormData();\n        textFormData.append('message_type', 'text');\n        textFormData.append('content', newMessage);\n        if (replyTo) {\n          textFormData.append('reply_to_id', replyTo.id);\n        }\n        \n        await axios.post(`/api/conversations/${selectedConversation.id}/messages`, textFormData, {\n          headers: { \n            'Authorization': `Bearer ${token}`,\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n      }\n      \n      // Send each image separately\n      for (const image of selectedImages) {\n        const imageFormData = new FormData();\n        imageFormData.append('file', image.file);\n        imageFormData.append('message_type', 'image');\n        imageFormData.append('content', '');\n        \n        await axios.post(`/api/conversations/${selectedConversation.id}/messages`, imageFormData, {\n          headers: { \n            'Authorization': `Bearer ${token}`,\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n      }\n\n      // Clear inputs immediately\n      setNewMessage('');\n      setReplyTo(null);\n      setSelectedImages([]);\n\n      // Immediately fetch new messages\n      fetchMessages(selectedConversation.id);\n      window.dispatchEvent(new Event('messageCountUpdate'));\n    } catch (error) {\n      console.error('Error sending message:', error);\n    } finally {\n      setSending(false);\n    }\n  };\n\n  const editMessage = async (messageId, newContent) => {\n    try {\n      const token = localStorage.getItem('token');\n      await axios.put(`/api/messages/${messageId}`, \n        { content: newContent },\n        { headers: { 'Authorization': `Bearer ${token}` } }\n      );\n      fetchMessages(selectedConversation.id);\n    } catch (error) {\n      console.error('Error editing message:', error);\n    }\n  };\n\n  const deleteMessage = async (messageId) => {\n    try {\n      const token = localStorage.getItem('token');\n      await axios.delete(`/api/messages/${messageId}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n      fetchMessages(selectedConversation.id);\n    } catch (error) {\n      console.error('Error deleting message:', error);\n    }\n  };\n\n  const shareLocation = () => {\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(async (position) => {\n        try {\n          const token = localStorage.getItem('token');\n          await axios.post(`/api/conversations/${selectedConversation.id}/messages`, {\n            message_type: 'location',\n            location_lat: position.coords.latitude,\n            location_lng: position.coords.longitude,\n            location_name: 'Current Location'\n          }, {\n            headers: { 'Authorization': `Bearer ${token}` }\n          });\n          fetchMessages(selectedConversation.id);\n        } catch (error) {\n          console.error('Error sharing location:', error);\n        }\n      });\n    }\n  };\n\n  const MessageBubble = ({ message, isOwn }) => {\n    const [isEditing, setIsEditing] = useState(false);\n    const [editContent, setEditContent] = useState(message.content);\n    const currentUser = JSON.parse(localStorage.getItem('user'));\n\n    // System messages (appointment notifications)\n    if (message.message_type === 'system') {\n      return (\n        <div style={{\n          display: 'flex',\n          justifyContent: 'center',\n          marginBottom: '1rem'\n        }}>\n          <div style={{\n            background: '#f0f8ff',\n            color: '#666',\n            padding: '0.5rem 1rem',\n            borderRadius: '12px',\n            fontSize: '0.9rem',\n            border: '1px solid #e0e8f0'\n          }}>\n            {message.content}\n            <div style={{ fontSize: '0.7rem', opacity: 0.7, marginTop: '0.25rem', textAlign: 'center' }}>\n              {new Date(message.created_at).toLocaleTimeString()}\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <div style={{\n        display: 'flex',\n        justifyContent: isOwn ? 'flex-end' : 'flex-start',\n        marginBottom: '1rem'\n      }}>\n        <div style={{\n          maxWidth: '70%',\n          background: isOwn ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : '#f1f1f1',\n          color: isOwn ? 'white' : 'black',\n          padding: '0.75rem 1rem',\n          borderRadius: '18px',\n          position: 'relative'\n        }}>\n          {message.reply_to && (\n            <div style={{\n              background: 'rgba(0,0,0,0.1)',\n              padding: '0.5rem',\n              borderRadius: '8px',\n              marginBottom: '0.5rem',\n              fontSize: '0.8rem',\n              borderLeft: '3px solid rgba(255,255,255,0.5)'\n            }}>\n              <strong>{message.reply_to.sender_username}:</strong>\n              <div>{message.reply_to.content}</div>\n            </div>\n          )}\n\n          {message.message_type === 'image' && message.file_url && (\n            <img \n              src={`/api/uploads/${message.file_url}`}\n              alt=\"Shared image\"\n              style={{ maxWidth: '200px', borderRadius: '8px', marginBottom: '0.5rem' }}\n            />\n          )}\n\n          {message.message_type === 'location' && message.location && (\n            <div style={{ marginBottom: '0.5rem' }}>\n              📍 <strong>{message.location.name}</strong>\n              <br />\n              <small>Lat: {message.location.lat}, Lng: {message.location.lng}</small>\n            </div>\n          )}\n\n          {isEditing ? (\n            <div>\n              <input\n                value={editContent}\n                onChange={(e) => setEditContent(e.target.value)}\n                style={{ width: '100%', padding: '0.25rem', marginBottom: '0.5rem' }}\n              />\n              <div>\n                <button onClick={() => {\n                  editMessage(message.id, editContent);\n                  setIsEditing(false);\n                }} style={{ marginRight: '0.5rem', fontSize: '0.7rem' }}>Save</button>\n                <button onClick={() => setIsEditing(false)} style={{ fontSize: '0.7rem' }}>Cancel</button>\n              </div>\n            </div>\n          ) : (\n            <div>\n              {message.content}\n              {message.is_edited && <small style={{ opacity: 0.7 }}> (edited)</small>}\n            </div>\n          )}\n\n          <div style={{ fontSize: '0.7rem', opacity: 0.7, marginTop: '0.25rem' }}>\n            {new Date(message.created_at).toLocaleTimeString()}\n          </div>\n\n          {isOwn && message.sender_id === currentUser.id && !message.is_deleted && (\n            <div style={{ position: 'absolute', top: '-10px', right: '0', display: 'none' }} \n                 className=\"message-actions\">\n              <button onClick={() => setReplyTo(message)} style={{ fontSize: '0.6rem', margin: '0 2px' }}>Reply</button>\n              <button onClick={() => setIsEditing(true)} style={{ fontSize: '0.6rem', margin: '0 2px' }}>Edit</button>\n              <button onClick={() => deleteMessage(message.id)} style={{ fontSize: '0.6rem', margin: '0 2px' }}>Delete</button>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  if (loading) return <div style={{ textAlign: 'center', padding: '2rem' }}>Loading...</div>;\n\n  return (\n    <div style={{ maxWidth: '1200px', margin: '0 auto', padding: '2rem' }}>\n      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '3rem' }}>\n        <Link to=\"/\" style={{\n          color: 'white',\n          textDecoration: 'none',\n          padding: '0.75rem 1.5rem',\n          background: 'linear-gradient(135deg, #ff6b6b 0%, #feca57 100%)',\n          borderRadius: '12px',\n          fontWeight: '500',\n          transition: 'all 0.3s ease',\n          marginRight: '2rem',\n          boxShadow: '0 4px 15px rgba(255, 107, 107, 0.4)'\n        }}>← Home</Link>\n        <h2 style={{ \n          fontSize: '2.5rem',\n          fontWeight: '700',\n          background: 'linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3)',\n          WebkitBackgroundClip: 'text',\n          WebkitTextFillColor: 'transparent',\n          backgroundSize: '400% 400%',\n          animation: 'rainbow 3s ease-in-out infinite'\n        }}>Messages</h2>\n      </div>\n\n      <div style={{ display: 'flex', height: '600px', background: 'rgba(255, 255, 255, 0.95)', borderRadius: '16px', overflow: 'hidden' }}>\n        {/* Conversations List */}\n        <div style={{ width: '300px', borderRight: '1px solid #eee', overflow: 'auto' }}>\n          <div style={{ padding: '1rem', borderBottom: '1px solid #eee' }}>\n            <h3 style={{ marginBottom: '1rem' }}>Conversations</h3>\n            <input\n              type=\"text\"\n              placeholder=\"Search users...\"\n              value={searchUsers}\n              onChange={(e) => setSearchUsers(e.target.value)}\n              style={{\n                width: '100%',\n                padding: '0.5rem',\n                border: '1px solid #ddd',\n                borderRadius: '8px',\n                fontSize: '0.9rem'\n              }}\n            />\n          </div>\n          {conversations.map(conv => (\n            <div\n              key={conv.id}\n              onClick={() => setSelectedConversation(conv)}\n              style={{\n                padding: '1rem',\n                borderBottom: '1px solid #f0f0f0',\n                cursor: 'pointer',\n                background: selectedConversation?.id === conv.id ? '#f0f8ff' : 'transparent',\n                position: 'relative'\n              }}\n            >\n              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                <div style={{ fontWeight: conv.unread_count > 0 ? 'bold' : 'normal' }}>\n                  {conv.other_user.username}\n                </div>\n                {conv.unread_count > 0 && (\n                  <span style={{\n                    backgroundColor: '#e74c3c',\n                    color: 'white',\n                    borderRadius: '50%',\n                    width: '20px',\n                    height: '20px',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    fontSize: '0.7rem',\n                    fontWeight: 'bold'\n                  }}>\n                    {conv.unread_count}\n                  </span>\n                )}\n              </div>\n              {conv.item && <div style={{ fontSize: '0.8rem', color: '#666' }}>About: {conv.item.name}</div>}\n              {conv.last_message && (\n                <div style={{ \n                  fontSize: '0.8rem', \n                  color: conv.unread_count > 0 ? '#333' : '#999', \n                  marginTop: '0.25rem',\n                  fontWeight: conv.unread_count > 0 ? '500' : 'normal'\n                }}>\n                  {conv.last_message.content?.substring(0, 50)}...\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n\n        {/* Messages Area */}\n        <div style={{ flex: 1, display: 'flex', flexDirection: 'column' }}>\n          {selectedConversation ? (\n            <>\n              {/* Header */}\n              <div style={{ padding: '1rem', borderBottom: '1px solid #eee', background: '#f8f9fa' }}>\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                  <div>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                      <h4>{selectedConversation.other_user.username}</h4>\n                      <div style={{\n                        width: '8px',\n                        height: '8px',\n                        borderRadius: '50%',\n                        background: '#2ecc71',\n                        animation: 'pulse 2s infinite'\n                      }}></div>\n                    </div>\n                    {selectedConversation.item && (\n                      <small>Discussing: {selectedConversation.item.name}</small>\n                    )}\n                  </div>\n                  <button\n                    onClick={() => setShowAppointmentModal(true)}\n                    style={{\n                      background: '#f39c12',\n                      color: 'white',\n                      border: 'none',\n                      padding: '0.5rem 1rem',\n                      borderRadius: '8px',\n                      cursor: 'pointer',\n                      fontSize: '0.9rem'\n                    }}\n                  >\n                    📅 Schedule\n                  </button>\n                </div>\n                \n                {/* Appointments Header */}\n                {conversationAppointments.length > 0 && (\n                  <div style={{ marginTop: '1rem', padding: '0.75rem', background: '#e8f4fd', borderRadius: '8px' }}>\n                    <div style={{ fontSize: '0.9rem', fontWeight: 'bold', marginBottom: '0.5rem' }}>Appointments:</div>\n                    {conversationAppointments.map(apt => (\n                      <div \n                        key={apt.id}\n                        onClick={() => window.location.href = '/appointments'}\n                        style={{\n                          display: 'flex',\n                          justifyContent: 'space-between',\n                          alignItems: 'center',\n                          padding: '0.5rem',\n                          background: 'white',\n                          borderRadius: '6px',\n                          marginBottom: '0.25rem',\n                          cursor: 'pointer',\n                          fontSize: '0.8rem'\n                        }}\n                      >\n                        <span>📅 {new Date(apt.appointment_time).toLocaleDateString()} at {new Date(apt.appointment_time).toLocaleTimeString()}</span>\n                        <span style={{\n                          background: apt.status === 'confirmed' ? '#2ecc71' : apt.status === 'pending' ? '#f39c12' : '#e74c3c',\n                          color: 'white',\n                          padding: '0.2rem 0.5rem',\n                          borderRadius: '12px',\n                          fontSize: '0.7rem'\n                        }}>\n                          {apt.status}\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n\n              {/* Messages */}\n              <div style={{ flex: 1, padding: '1rem', overflow: 'auto' }}>\n                {messages.map(message => (\n                  <MessageBubble \n                    key={message.id} \n                    message={message} \n                    isOwn={message.sender_id === JSON.parse(localStorage.getItem('user')).id}\n                  />\n                ))}\n                <div ref={messagesEndRef} />\n              </div>\n\n              {/* Image Preview */}\n              {selectedImages.length > 0 && (\n                <div style={{ padding: '1rem', borderTop: '1px solid #eee', background: '#f8f9fa' }}>\n                  <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap', marginBottom: '0.5rem' }}>\n                    {selectedImages.map(image => (\n                      <div key={image.id} style={{ position: 'relative', display: 'inline-block' }}>\n                        <img\n                          src={image.preview}\n                          alt=\"Preview\"\n                          style={{\n                            width: '80px',\n                            height: '80px',\n                            objectFit: 'cover',\n                            borderRadius: '8px',\n                            border: '2px solid #e0e0e0'\n                          }}\n                        />\n                        <button\n                          onClick={() => removeImage(image.id)}\n                          style={{\n                            position: 'absolute',\n                            top: '-5px',\n                            right: '-5px',\n                            width: '20px',\n                            height: '20px',\n                            borderRadius: '50%',\n                            background: '#e74c3c',\n                            color: 'white',\n                            border: 'none',\n                            cursor: 'pointer',\n                            fontSize: '12px',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center'\n                          }}\n                        >\n                          ✕\n                        </button>\n                      </div>\n                    ))}\n                  </div>\n                  <small style={{ color: '#666' }}>{selectedImages.length} image(s) selected</small>\n                </div>\n              )}\n              \n              {/* Reply Preview */}\n              {replyTo && (\n                <div style={{ padding: '0.5rem 1rem', background: '#f0f8ff', borderTop: '1px solid #eee' }}>\n                  <small>Replying to: {replyTo.content}</small>\n                  <button onClick={() => setReplyTo(null)} style={{ float: 'right', background: 'none', border: 'none' }}>✕</button>\n                </div>\n              )}\n\n              {/* Input Area */}\n              <form onSubmit={sendMessage} style={{ padding: '1rem', borderTop: '1px solid #eee', display: 'flex', gap: '0.5rem' }}>\n                <input\n                  type=\"file\"\n                  ref={fileInputRef}\n                  accept=\"image/*\"\n                  multiple\n                  onChange={handleImageSelect}\n                  style={{ display: 'none' }}\n                />\n                <button type=\"button\" onClick={() => fileInputRef.current?.click()} style={{ padding: '0.5rem', background: 'none', border: 'none', cursor: 'pointer', fontSize: '1.2rem' }}>📷</button>\n                <button type=\"button\" onClick={shareLocation} style={{ padding: '0.5rem' }}>📍</button>\n                <input\n                  type=\"text\"\n                  value={newMessage}\n                  onChange={(e) => setNewMessage(e.target.value)}\n                  placeholder=\"Type a message...\"\n                  style={{ flex: 1, padding: '0.75rem', border: '1px solid #ddd', borderRadius: '20px' }}\n                />\n                <button \n                  type=\"submit\" \n                  disabled={sending || (!newMessage.trim() && selectedImages.length === 0)}\n                  style={{ \n                    padding: '0.5rem 1rem', \n                    background: sending ? '#95a5a6' : (!newMessage.trim() && selectedImages.length === 0) ? '#ddd' : '#007bff', \n                    color: 'white', \n                    border: 'none', \n                    borderRadius: '20px',\n                    cursor: (sending || (!newMessage.trim() && selectedImages.length === 0)) ? 'not-allowed' : 'pointer',\n                    opacity: (sending || (!newMessage.trim() && selectedImages.length === 0)) ? 0.7 : 1,\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '0.25rem'\n                  }}\n                >\n                  {sending ? 'Sending...' : (\n                    <>\n                      Send\n                      {selectedImages.length > 0 && (\n                        <span style={{\n                          background: 'rgba(255,255,255,0.3)',\n                          borderRadius: '10px',\n                          padding: '0.1rem 0.4rem',\n                          fontSize: '0.8rem'\n                        }}>\n                          +{selectedImages.length}\n                        </span>\n                      )}\n                    </>\n                  )}\n                </button>\n              </form>\n            </>\n          ) : (\n            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100%' }}>\n              <p>Select a conversation to start messaging</p>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <style jsx>{`\n        .message-actions {\n          display: none;\n        }\n        div:hover .message-actions {\n          display: block;\n        }\n        @keyframes pulse {\n          0% {\n            opacity: 1;\n            transform: scale(1);\n          }\n          50% {\n            opacity: 0.5;\n            transform: scale(1.2);\n          }\n          100% {\n            opacity: 1;\n            transform: scale(1);\n          }\n        }\n      `}</style>\n      \n      {/* Appointment Modal */}\n      {showAppointmentModal && (\n        <div style={{\n          position: 'fixed',\n          top: 0,\n          left: 0,\n          right: 0,\n          bottom: 0,\n          backgroundColor: 'rgba(0, 0, 0, 0.7)',\n          display: 'flex',\n          justifyContent: 'center',\n          alignItems: 'center',\n          zIndex: 1000\n        }}>\n          <div style={{\n            background: 'rgba(255, 255, 255, 0.95)',\n            backdropFilter: 'blur(20px)',\n            borderRadius: '24px',\n            boxShadow: '0 20px 60px rgba(0,0,0,0.3)',\n            border: '1px solid rgba(255, 255, 255, 0.2)',\n            padding: '2rem',\n            maxWidth: '500px',\n            width: '90%'\n          }}>\n            <h3 style={{ marginBottom: '1rem' }}>Schedule Appointment</h3>\n            <form onSubmit={(e) => {\n              e.preventDefault();\n              const formData = new FormData(e.target);\n              createAppointment({\n                appointment_time: formData.get('appointment_time'),\n                location: formData.get('location'),\n                notes: formData.get('notes')\n              });\n            }}>\n              <div style={{ marginBottom: '1rem' }}>\n                <label style={{ display: 'block', marginBottom: '0.5rem' }}>Date & Time:</label>\n                <input\n                  type=\"datetime-local\"\n                  name=\"appointment_time\"\n                  min={new Date().toISOString().slice(0, 16)}\n                  style={{ width: '100%', padding: '0.5rem', borderRadius: '4px', border: '1px solid #ddd' }}\n                  required\n                />\n              </div>\n              <div style={{ marginBottom: '1rem' }}>\n                <label style={{ display: 'block', marginBottom: '0.5rem' }}>Location:</label>\n                <input\n                  type=\"text\"\n                  name=\"location\"\n                  placeholder=\"Meeting location\"\n                  style={{ width: '100%', padding: '0.5rem', borderRadius: '4px', border: '1px solid #ddd' }}\n                  required\n                />\n              </div>\n              <div style={{ marginBottom: '1rem' }}>\n                <label style={{ display: 'block', marginBottom: '0.5rem' }}>Notes:</label>\n                <textarea\n                  name=\"notes\"\n                  placeholder=\"Additional notes...\"\n                  rows=\"3\"\n                  style={{ width: '100%', padding: '0.5rem', borderRadius: '4px', border: '1px solid #ddd' }}\n                />\n              </div>\n              <div style={{ display: 'flex', gap: '1rem' }}>\n                <button\n                  type=\"button\"\n                  onClick={() => setShowAppointmentModal(false)}\n                  style={{ flex: 1, padding: '0.75rem', background: '#95a5a6', color: 'white', border: 'none', borderRadius: '8px' }}\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  style={{ flex: 1, padding: '0.75rem', background: '#f39c12', color: 'white', border: 'none', borderRadius: '8px' }}\n                >\n                  Create Appointment\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Messages;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,MAAM,KAAQ,OAAO,CAC1D,OAASC,IAAI,KAAQ,kBAAkB,CACvC,MAAO,CAAAC,KAAK,KAAM,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAE1B,KAAM,CAAAC,QAAQ,CAAGA,CAAA,GAAM,CACrB,KAAM,CAACC,aAAa,CAAEC,gBAAgB,CAAC,CAAGb,QAAQ,CAAC,EAAE,CAAC,CACtD,KAAM,CAACc,oBAAoB,CAAEC,uBAAuB,CAAC,CAAGf,QAAQ,CAAC,IAAI,CAAC,CACtE,KAAM,CAACgB,QAAQ,CAAEC,WAAW,CAAC,CAAGjB,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACkB,UAAU,CAAEC,aAAa,CAAC,CAAGnB,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAACoB,OAAO,CAAEC,UAAU,CAAC,CAAGrB,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACsB,OAAO,CAAEC,UAAU,CAAC,CAAGvB,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACwB,oBAAoB,CAAEC,uBAAuB,CAAC,CAAGzB,QAAQ,CAAC,KAAK,CAAC,CACvE,KAAM,CAAC0B,wBAAwB,CAAEC,2BAA2B,CAAC,CAAG3B,QAAQ,CAAC,EAAE,CAAC,CAC5E,KAAM,CAAC4B,WAAW,CAAEC,cAAc,CAAC,CAAG7B,QAAQ,CAAC,EAAE,CAAC,CAClD,KAAM,CAAC8B,OAAO,CAAEC,UAAU,CAAC,CAAG/B,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACgC,cAAc,CAAEC,iBAAiB,CAAC,CAAGjC,QAAQ,CAAC,EAAE,CAAC,CACxD,KAAM,CAAAkC,cAAc,CAAGhC,MAAM,CAAC,IAAI,CAAC,CACnC,KAAM,CAAAiC,YAAY,CAAGjC,MAAM,CAAC,IAAI,CAAC,CAEjCD,SAAS,CAAC,IAAM,CACdmC,kBAAkB,CAAC,CAAC,CAEpB;AACA,KAAM,CAAAC,oBAAoB,CAAGC,WAAW,CAAC,IAAM,CAC7CF,kBAAkB,CAAC,CAAC,CACtB,CAAC,CAAE,IAAI,CAAC,CAER,MAAO,IAAMG,aAAa,CAACF,oBAAoB,CAAC,CAClD,CAAC,CAAE,EAAE,CAAC,CAEN;AACApC,SAAS,CAAC,IAAM,CACd,KAAM,CAAAuC,SAAS,CAAGC,UAAU,CAAC,IAAM,CACjCL,kBAAkB,CAAC,CAAC,CACtB,CAAC,CAAE,GAAG,CAAC,CAEP,MAAO,IAAMM,YAAY,CAACF,SAAS,CAAC,CACtC,CAAC,CAAE,CAACZ,WAAW,CAAC,CAAC,CAEjB3B,SAAS,CAAC,IAAM,CACd,GAAIa,oBAAoB,CAAE,CACxB6B,aAAa,CAAC7B,oBAAoB,CAAC8B,EAAE,CAAC,CACtCC,kBAAkB,CAAC/B,oBAAoB,CAAC8B,EAAE,CAAC,CAC3CE,6BAA6B,CAAChC,oBAAoB,CAAC8B,EAAE,CAAC,CAEtD;AACA,KAAM,CAAAG,eAAe,CAAGT,WAAW,CAAC,IAAM,CACxCK,aAAa,CAAC7B,oBAAoB,CAAC8B,EAAE,CAAC,CACtCC,kBAAkB,CAAC/B,oBAAoB,CAAC8B,EAAE,CAAC,CAC7C,CAAC,CAAE,IAAI,CAAC,CAER;AACA,KAAM,CAAAI,mBAAmB,CAAGV,WAAW,CAAC,IAAM,CAC5CQ,6BAA6B,CAAChC,oBAAoB,CAAC8B,EAAE,CAAC,CACxD,CAAC,CAAE,IAAI,CAAC,CAER,MAAO,IAAM,CACXL,aAAa,CAACQ,eAAe,CAAC,CAC9BR,aAAa,CAACS,mBAAmB,CAAC,CACpC,CAAC,CACH,CACF,CAAC,CAAE,CAAClC,oBAAoB,CAAC,CAAC,CAE1Bb,SAAS,CAAC,IAAM,CACdgD,cAAc,CAAC,CAAC,CAClB,CAAC,CAAE,CAACjC,QAAQ,CAAC,CAAC,CAEd,KAAM,CAAAiC,cAAc,CAAGA,CAAA,GAAM,KAAAC,qBAAA,CAC3B,CAAAA,qBAAA,CAAAhB,cAAc,CAACiB,OAAO,UAAAD,qBAAA,iBAAtBA,qBAAA,CAAwBE,cAAc,CAAC,CAAEC,QAAQ,CAAE,QAAS,CAAC,CAAC,CAChE,CAAC,CAED;AACApD,SAAS,CAAC,IAAM,CACd,KAAM,CAAAqD,KAAK,CAAGb,UAAU,CAAC,IAAM,CAC7BQ,cAAc,CAAC,CAAC,CAClB,CAAC,CAAE,GAAG,CAAC,CACP,MAAO,IAAMP,YAAY,CAACY,KAAK,CAAC,CAClC,CAAC,CAAE,CAACtC,QAAQ,CAACuC,MAAM,CAAC,CAAC,CAErB,KAAM,CAAAnB,kBAAkB,CAAG,KAAAA,CAAA,GAAY,CACrC,GAAI,CACF,KAAM,CAAAoB,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,KAAM,CAAAC,MAAM,CAAG/B,WAAW,CAAG,WAAWgC,kBAAkB,CAAChC,WAAW,CAAC,EAAE,CAAG,EAAE,CAC9E,KAAM,CAAAiC,QAAQ,CAAG,KAAM,CAAAzD,KAAK,CAAC0D,GAAG,CAAC,qBAAqBH,MAAM,EAAE,CAAE,CAC9DI,OAAO,CAAE,CAAE,eAAe,CAAE,UAAUP,KAAK,EAAG,CAChD,CAAC,CAAC,CACF3C,gBAAgB,CAACgD,QAAQ,CAACG,IAAI,CAAC,CACjC,CAAE,MAAOC,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,+BAA+B,CAAEA,KAAK,CAAC,CACvD,CAAC,OAAS,CACR1C,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAED,KAAM,CAAA4C,gBAAgB,CAAGA,CAAA,GAAM,CAC7B/B,kBAAkB,CAAC,CAAC,CACtB,CAAC,CAED,KAAM,CAAAO,aAAa,CAAG,KAAO,CAAAyB,cAAc,EAAK,CAC9C,GAAI,CACF,KAAM,CAAAZ,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,KAAM,CAAAG,QAAQ,CAAG,KAAM,CAAAzD,KAAK,CAAC0D,GAAG,CAAC,sBAAsBM,cAAc,WAAW,CAAE,CAChFL,OAAO,CAAE,CAAE,eAAe,CAAE,UAAUP,KAAK,EAAG,CAChD,CAAC,CAAC,CACFvC,WAAW,CAAC4C,QAAQ,CAACG,IAAI,CAAC,CAC5B,CAAE,MAAOC,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,CAAEA,KAAK,CAAC,CAClD,CACF,CAAC,CAED,KAAM,CAAApB,kBAAkB,CAAG,KAAO,CAAAuB,cAAc,EAAK,CACnD,GAAI,CACF,KAAM,CAAAZ,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,KAAM,CAAAtD,KAAK,CAACiE,IAAI,CAAC,sBAAsBD,cAAc,YAAY,CAAE,CAAC,CAAC,CAAE,CACrEL,OAAO,CAAE,CAAE,eAAe,CAAE,UAAUP,KAAK,EAAG,CAChD,CAAC,CAAC,CACF;AACAc,MAAM,CAACC,aAAa,CAAC,GAAI,CAAAC,KAAK,CAAC,oBAAoB,CAAC,CAAC,CACvD,CAAE,MAAOP,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,iCAAiC,CAAEA,KAAK,CAAC,CACzD,CACF,CAAC,CAED,KAAM,CAAAnB,6BAA6B,CAAG,KAAO,CAAAsB,cAAc,EAAK,CAC9D,GAAI,CACF,KAAM,CAAAZ,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,KAAM,CAAAG,QAAQ,CAAG,KAAM,CAAAzD,KAAK,CAAC0D,GAAG,CAAC,sBAAsBM,cAAc,eAAe,CAAE,CACpFL,OAAO,CAAE,CAAE,eAAe,CAAE,UAAUP,KAAK,EAAG,CAChD,CAAC,CAAC,CACF7B,2BAA2B,CAACkC,QAAQ,CAACG,IAAI,CAAC,CAC5C,CAAE,MAAOC,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,8BAA8B,CAAEA,KAAK,CAAC,CACtD,CACF,CAAC,CAED,KAAM,CAAAQ,iBAAiB,CAAG,KAAO,CAAAC,eAAe,EAAK,CACnD,GAAI,CACF,KAAM,CAAAlB,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,KAAM,CAAAtD,KAAK,CAACiE,IAAI,CAAC,sBAAsBvD,oBAAoB,CAAC8B,EAAE,eAAe,CAAE8B,eAAe,CAAE,CAC9FX,OAAO,CAAE,CAAE,eAAe,CAAE,UAAUP,KAAK,EAAG,CAChD,CAAC,CAAC,CACFV,6BAA6B,CAAChC,oBAAoB,CAAC8B,EAAE,CAAC,CACtDD,aAAa,CAAC7B,oBAAoB,CAAC8B,EAAE,CAAC,CACtCnB,uBAAuB,CAAC,KAAK,CAAC,CAChC,CAAE,MAAOwC,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,6BAA6B,CAAEA,KAAK,CAAC,CACrD,CACF,CAAC,CAED,KAAM,CAAAU,iBAAiB,CAAIC,CAAC,EAAK,CAC/B,KAAM,CAAAC,KAAK,CAAGC,KAAK,CAACC,IAAI,CAACH,CAAC,CAACI,MAAM,CAACH,KAAK,CAAC,CACxC,KAAM,CAAAI,UAAU,CAAGJ,KAAK,CAACK,MAAM,CAACC,IAAI,EAAIA,IAAI,CAACC,IAAI,CAACC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAEvE,KAAM,CAAAC,aAAa,CAAGL,UAAU,CAACM,GAAG,CAACJ,IAAI,EAAI,CAC3C,MAAO,IAAI,CAAAK,OAAO,CAAEC,OAAO,EAAK,CAC9B,KAAM,CAAAC,MAAM,CAAG,GAAI,CAAAC,UAAU,CAAC,CAAC,CAC/BD,MAAM,CAACE,MAAM,CAAIhB,CAAC,EAAK,CACrBa,OAAO,CAAC,CACNN,IAAI,CAAEA,IAAI,CACVU,OAAO,CAAEjB,CAAC,CAACI,MAAM,CAACc,MAAM,CACxBlD,EAAE,CAAEmD,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,MAAM,CAAC,CAAC,CAAE,CAAC,CAC5C,CAAC,CAAC,CACJ,CAAC,CACDR,MAAM,CAACS,aAAa,CAAChB,IAAI,CAAC,CAC5B,CAAC,CAAC,CACJ,CAAC,CAAC,CAEFK,OAAO,CAACY,GAAG,CAACd,aAAa,CAAC,CAACe,IAAI,CAACC,MAAM,EAAI,CACxCrE,iBAAiB,CAACsE,IAAI,EAAI,CAAC,GAAGA,IAAI,CAAE,GAAGD,MAAM,CAAC,CAAC,CACjD,CAAC,CAAC,CAEF;AACA,GAAInE,YAAY,CAACgB,OAAO,CAAEhB,YAAY,CAACgB,OAAO,CAACqD,KAAK,CAAG,EAAE,CAC3D,CAAC,CAED,KAAM,CAAAC,WAAW,CAAIC,OAAO,EAAK,CAC/BzE,iBAAiB,CAACsE,IAAI,EAAIA,IAAI,CAACrB,MAAM,CAACyB,GAAG,EAAIA,GAAG,CAAC/D,EAAE,GAAK8D,OAAO,CAAC,CAAC,CACnE,CAAC,CAED,KAAM,CAAAE,WAAW,CAAG,KAAO,CAAAhC,CAAC,EAAK,CAC/BA,CAAC,CAACiC,cAAc,CAAC,CAAC,CAClB,GAAI,CAAC3F,UAAU,CAAC4F,IAAI,CAAC,CAAC,EAAI9E,cAAc,CAACuB,MAAM,GAAK,CAAC,CAAE,OACvD,GAAIzB,OAAO,CAAE,OAEbC,UAAU,CAAC,IAAI,CAAC,CAChB,GAAI,CACF,KAAM,CAAAyB,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAE3C;AACA,GAAIxC,UAAU,CAAC4F,IAAI,CAAC,CAAC,CAAE,CACrB,KAAM,CAAAC,YAAY,CAAG,GAAI,CAAAC,QAAQ,CAAC,CAAC,CACnCD,YAAY,CAACE,MAAM,CAAC,cAAc,CAAE,MAAM,CAAC,CAC3CF,YAAY,CAACE,MAAM,CAAC,SAAS,CAAE/F,UAAU,CAAC,CAC1C,GAAIE,OAAO,CAAE,CACX2F,YAAY,CAACE,MAAM,CAAC,aAAa,CAAE7F,OAAO,CAACwB,EAAE,CAAC,CAChD,CAEA,KAAM,CAAAxC,KAAK,CAACiE,IAAI,CAAC,sBAAsBvD,oBAAoB,CAAC8B,EAAE,WAAW,CAAEmE,YAAY,CAAE,CACvFhD,OAAO,CAAE,CACP,eAAe,CAAE,UAAUP,KAAK,EAAE,CAClC,cAAc,CAAE,qBAClB,CACF,CAAC,CAAC,CACJ,CAEA;AACA,IAAK,KAAM,CAAA0D,KAAK,GAAI,CAAAlF,cAAc,CAAE,CAClC,KAAM,CAAAmF,aAAa,CAAG,GAAI,CAAAH,QAAQ,CAAC,CAAC,CACpCG,aAAa,CAACF,MAAM,CAAC,MAAM,CAAEC,KAAK,CAAC/B,IAAI,CAAC,CACxCgC,aAAa,CAACF,MAAM,CAAC,cAAc,CAAE,OAAO,CAAC,CAC7CE,aAAa,CAACF,MAAM,CAAC,SAAS,CAAE,EAAE,CAAC,CAEnC,KAAM,CAAA7G,KAAK,CAACiE,IAAI,CAAC,sBAAsBvD,oBAAoB,CAAC8B,EAAE,WAAW,CAAEuE,aAAa,CAAE,CACxFpD,OAAO,CAAE,CACP,eAAe,CAAE,UAAUP,KAAK,EAAE,CAClC,cAAc,CAAE,qBAClB,CACF,CAAC,CAAC,CACJ,CAEA;AACArC,aAAa,CAAC,EAAE,CAAC,CACjBE,UAAU,CAAC,IAAI,CAAC,CAChBY,iBAAiB,CAAC,EAAE,CAAC,CAErB;AACAU,aAAa,CAAC7B,oBAAoB,CAAC8B,EAAE,CAAC,CACtC0B,MAAM,CAACC,aAAa,CAAC,GAAI,CAAAC,KAAK,CAAC,oBAAoB,CAAC,CAAC,CACvD,CAAE,MAAOP,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,wBAAwB,CAAEA,KAAK,CAAC,CAChD,CAAC,OAAS,CACRlC,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAED,KAAM,CAAAqF,WAAW,CAAG,KAAAA,CAAOC,SAAS,CAAEC,UAAU,GAAK,CACnD,GAAI,CACF,KAAM,CAAA9D,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,KAAM,CAAAtD,KAAK,CAACmH,GAAG,CAAC,iBAAiBF,SAAS,EAAE,CAC1C,CAAEG,OAAO,CAAEF,UAAW,CAAC,CACvB,CAAEvD,OAAO,CAAE,CAAE,eAAe,CAAE,UAAUP,KAAK,EAAG,CAAE,CACpD,CAAC,CACDb,aAAa,CAAC7B,oBAAoB,CAAC8B,EAAE,CAAC,CACxC,CAAE,MAAOqB,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,wBAAwB,CAAEA,KAAK,CAAC,CAChD,CACF,CAAC,CAED,KAAM,CAAAwD,aAAa,CAAG,KAAO,CAAAJ,SAAS,EAAK,CACzC,GAAI,CACF,KAAM,CAAA7D,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,KAAM,CAAAtD,KAAK,CAACsH,MAAM,CAAC,iBAAiBL,SAAS,EAAE,CAAE,CAC/CtD,OAAO,CAAE,CAAE,eAAe,CAAE,UAAUP,KAAK,EAAG,CAChD,CAAC,CAAC,CACFb,aAAa,CAAC7B,oBAAoB,CAAC8B,EAAE,CAAC,CACxC,CAAE,MAAOqB,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,yBAAyB,CAAEA,KAAK,CAAC,CACjD,CACF,CAAC,CAED,KAAM,CAAA0D,aAAa,CAAGA,CAAA,GAAM,CAC1B,GAAIC,SAAS,CAACC,WAAW,CAAE,CACzBD,SAAS,CAACC,WAAW,CAACC,kBAAkB,CAAC,KAAO,CAAAC,QAAQ,EAAK,CAC3D,GAAI,CACF,KAAM,CAAAvE,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,KAAM,CAAAtD,KAAK,CAACiE,IAAI,CAAC,sBAAsBvD,oBAAoB,CAAC8B,EAAE,WAAW,CAAE,CACzEoF,YAAY,CAAE,UAAU,CACxBC,YAAY,CAAEF,QAAQ,CAACG,MAAM,CAACC,QAAQ,CACtCC,YAAY,CAAEL,QAAQ,CAACG,MAAM,CAACG,SAAS,CACvCC,aAAa,CAAE,kBACjB,CAAC,CAAE,CACDvE,OAAO,CAAE,CAAE,eAAe,CAAE,UAAUP,KAAK,EAAG,CAChD,CAAC,CAAC,CACFb,aAAa,CAAC7B,oBAAoB,CAAC8B,EAAE,CAAC,CACxC,CAAE,MAAOqB,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,yBAAyB,CAAEA,KAAK,CAAC,CACjD,CACF,CAAC,CAAC,CACJ,CACF,CAAC,CAED,KAAM,CAAAsE,aAAa,CAAGC,IAAA,EAAwB,IAAvB,CAAEC,OAAO,CAAEC,KAAM,CAAC,CAAAF,IAAA,CACvC,KAAM,CAACG,SAAS,CAAEC,YAAY,CAAC,CAAG5I,QAAQ,CAAC,KAAK,CAAC,CACjD,KAAM,CAAC6I,WAAW,CAAEC,cAAc,CAAC,CAAG9I,QAAQ,CAACyI,OAAO,CAACjB,OAAO,CAAC,CAC/D,KAAM,CAAAuB,WAAW,CAAGC,IAAI,CAACC,KAAK,CAACxF,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,CAE5D;AACA,GAAI+E,OAAO,CAACT,YAAY,GAAK,QAAQ,CAAE,CACrC,mBACE1H,IAAA,QAAK4I,KAAK,CAAE,CACVC,OAAO,CAAE,MAAM,CACfC,cAAc,CAAE,QAAQ,CACxBC,YAAY,CAAE,MAChB,CAAE,CAAAC,QAAA,cACA9I,KAAA,QAAK0I,KAAK,CAAE,CACVK,UAAU,CAAE,SAAS,CACrBC,KAAK,CAAE,MAAM,CACbC,OAAO,CAAE,aAAa,CACtBC,YAAY,CAAE,MAAM,CACpBC,QAAQ,CAAE,QAAQ,CAClBC,MAAM,CAAE,mBACV,CAAE,CAAAN,QAAA,EACCb,OAAO,CAACjB,OAAO,cAChBlH,IAAA,QAAK4I,KAAK,CAAE,CAAES,QAAQ,CAAE,QAAQ,CAAEE,OAAO,CAAE,GAAG,CAAEC,SAAS,CAAE,SAAS,CAAEC,SAAS,CAAE,QAAS,CAAE,CAAAT,QAAA,CACzF,GAAI,CAAAU,IAAI,CAACvB,OAAO,CAACwB,UAAU,CAAC,CAACC,kBAAkB,CAAC,CAAC,CAC/C,CAAC,EACH,CAAC,CACH,CAAC,CAEV,CAEA,mBACE5J,IAAA,QAAK4I,KAAK,CAAE,CACVC,OAAO,CAAE,MAAM,CACfC,cAAc,CAAEV,KAAK,CAAG,UAAU,CAAG,YAAY,CACjDW,YAAY,CAAE,MAChB,CAAE,CAAAC,QAAA,cACA9I,KAAA,QAAK0I,KAAK,CAAE,CACViB,QAAQ,CAAE,KAAK,CACfZ,UAAU,CAAEb,KAAK,CAAG,mDAAmD,CAAG,SAAS,CACnFc,KAAK,CAAEd,KAAK,CAAG,OAAO,CAAG,OAAO,CAChCe,OAAO,CAAE,cAAc,CACvBC,YAAY,CAAE,MAAM,CACpB3B,QAAQ,CAAE,UACZ,CAAE,CAAAuB,QAAA,EACCb,OAAO,CAAC2B,QAAQ,eACf5J,KAAA,QAAK0I,KAAK,CAAE,CACVK,UAAU,CAAE,iBAAiB,CAC7BE,OAAO,CAAE,QAAQ,CACjBC,YAAY,CAAE,KAAK,CACnBL,YAAY,CAAE,QAAQ,CACtBM,QAAQ,CAAE,QAAQ,CAClBU,UAAU,CAAE,iCACd,CAAE,CAAAf,QAAA,eACA9I,KAAA,WAAA8I,QAAA,EAASb,OAAO,CAAC2B,QAAQ,CAACE,eAAe,CAAC,GAAC,EAAQ,CAAC,cACpDhK,IAAA,QAAAgJ,QAAA,CAAMb,OAAO,CAAC2B,QAAQ,CAAC5C,OAAO,CAAM,CAAC,EAClC,CACN,CAEAiB,OAAO,CAACT,YAAY,GAAK,OAAO,EAAIS,OAAO,CAAC8B,QAAQ,eACnDjK,IAAA,QACEkK,GAAG,CAAE,gBAAgB/B,OAAO,CAAC8B,QAAQ,EAAG,CACxCE,GAAG,CAAC,cAAc,CAClBvB,KAAK,CAAE,CAAEiB,QAAQ,CAAE,OAAO,CAAET,YAAY,CAAE,KAAK,CAAEL,YAAY,CAAE,QAAS,CAAE,CAC3E,CACF,CAEAZ,OAAO,CAACT,YAAY,GAAK,UAAU,EAAIS,OAAO,CAACiC,QAAQ,eACtDlK,KAAA,QAAK0I,KAAK,CAAE,CAAEG,YAAY,CAAE,QAAS,CAAE,CAAAC,QAAA,EAAC,eACnC,cAAAhJ,IAAA,WAAAgJ,QAAA,CAASb,OAAO,CAACiC,QAAQ,CAACC,IAAI,CAAS,CAAC,cAC3CrK,IAAA,QAAK,CAAC,cACNE,KAAA,UAAA8I,QAAA,EAAO,OAAK,CAACb,OAAO,CAACiC,QAAQ,CAACE,GAAG,CAAC,SAAO,CAACnC,OAAO,CAACiC,QAAQ,CAACG,GAAG,EAAQ,CAAC,EACpE,CACN,CAEAlC,SAAS,cACRnI,KAAA,QAAA8I,QAAA,eACEhJ,IAAA,UACEkG,KAAK,CAAEqC,WAAY,CACnBiC,QAAQ,CAAGlG,CAAC,EAAKkE,cAAc,CAAClE,CAAC,CAACI,MAAM,CAACwB,KAAK,CAAE,CAChD0C,KAAK,CAAE,CAAE6B,KAAK,CAAE,MAAM,CAAEtB,OAAO,CAAE,SAAS,CAAEJ,YAAY,CAAE,QAAS,CAAE,CACtE,CAAC,cACF7I,KAAA,QAAA8I,QAAA,eACEhJ,IAAA,WAAQ0K,OAAO,CAAEA,CAAA,GAAM,CACrB5D,WAAW,CAACqB,OAAO,CAAC7F,EAAE,CAAEiG,WAAW,CAAC,CACpCD,YAAY,CAAC,KAAK,CAAC,CACrB,CAAE,CAACM,KAAK,CAAE,CAAE+B,WAAW,CAAE,QAAQ,CAAEtB,QAAQ,CAAE,QAAS,CAAE,CAAAL,QAAA,CAAC,MAAI,CAAQ,CAAC,cACtEhJ,IAAA,WAAQ0K,OAAO,CAAEA,CAAA,GAAMpC,YAAY,CAAC,KAAK,CAAE,CAACM,KAAK,CAAE,CAAES,QAAQ,CAAE,QAAS,CAAE,CAAAL,QAAA,CAAC,QAAM,CAAQ,CAAC,EACvF,CAAC,EACH,CAAC,cAEN9I,KAAA,QAAA8I,QAAA,EACGb,OAAO,CAACjB,OAAO,CACfiB,OAAO,CAACyC,SAAS,eAAI5K,IAAA,UAAO4I,KAAK,CAAE,CAAEW,OAAO,CAAE,GAAI,CAAE,CAAAP,QAAA,CAAC,WAAS,CAAO,CAAC,EACpE,CACN,cAEDhJ,IAAA,QAAK4I,KAAK,CAAE,CAAES,QAAQ,CAAE,QAAQ,CAAEE,OAAO,CAAE,GAAG,CAAEC,SAAS,CAAE,SAAU,CAAE,CAAAR,QAAA,CACpE,GAAI,CAAAU,IAAI,CAACvB,OAAO,CAACwB,UAAU,CAAC,CAACC,kBAAkB,CAAC,CAAC,CAC/C,CAAC,CAELxB,KAAK,EAAID,OAAO,CAAC0C,SAAS,GAAKpC,WAAW,CAACnG,EAAE,EAAI,CAAC6F,OAAO,CAAC2C,UAAU,eACnE5K,KAAA,QAAK0I,KAAK,CAAE,CAAEnB,QAAQ,CAAE,UAAU,CAAEsD,GAAG,CAAE,OAAO,CAAEC,KAAK,CAAE,GAAG,CAAEnC,OAAO,CAAE,MAAO,CAAE,CAC3EoC,SAAS,CAAC,iBAAiB,CAAAjC,QAAA,eAC9BhJ,IAAA,WAAQ0K,OAAO,CAAEA,CAAA,GAAM3J,UAAU,CAACoH,OAAO,CAAE,CAACS,KAAK,CAAE,CAAES,QAAQ,CAAE,QAAQ,CAAE6B,MAAM,CAAE,OAAQ,CAAE,CAAAlC,QAAA,CAAC,OAAK,CAAQ,CAAC,cAC1GhJ,IAAA,WAAQ0K,OAAO,CAAEA,CAAA,GAAMpC,YAAY,CAAC,IAAI,CAAE,CAACM,KAAK,CAAE,CAAES,QAAQ,CAAE,QAAQ,CAAE6B,MAAM,CAAE,OAAQ,CAAE,CAAAlC,QAAA,CAAC,MAAI,CAAQ,CAAC,cACxGhJ,IAAA,WAAQ0K,OAAO,CAAEA,CAAA,GAAMvD,aAAa,CAACgB,OAAO,CAAC7F,EAAE,CAAE,CAACsG,KAAK,CAAE,CAAES,QAAQ,CAAE,QAAQ,CAAE6B,MAAM,CAAE,OAAQ,CAAE,CAAAlC,QAAA,CAAC,QAAM,CAAQ,CAAC,EAC9G,CACN,EACE,CAAC,CACH,CAAC,CAEV,CAAC,CAED,GAAIhI,OAAO,CAAE,mBAAOhB,IAAA,QAAK4I,KAAK,CAAE,CAAEa,SAAS,CAAE,QAAQ,CAAEN,OAAO,CAAE,MAAO,CAAE,CAAAH,QAAA,CAAC,YAAU,CAAK,CAAC,CAE1F,mBACE9I,KAAA,QAAK0I,KAAK,CAAE,CAAEiB,QAAQ,CAAE,QAAQ,CAAEqB,MAAM,CAAE,QAAQ,CAAE/B,OAAO,CAAE,MAAO,CAAE,CAAAH,QAAA,eACpE9I,KAAA,QAAK0I,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAM,CAAEsC,UAAU,CAAE,QAAQ,CAAErC,cAAc,CAAE,QAAQ,CAAEC,YAAY,CAAE,MAAO,CAAE,CAAAC,QAAA,eACpGhJ,IAAA,CAACH,IAAI,EAACuL,EAAE,CAAC,GAAG,CAACxC,KAAK,CAAE,CAClBM,KAAK,CAAE,OAAO,CACdmC,cAAc,CAAE,MAAM,CACtBlC,OAAO,CAAE,gBAAgB,CACzBF,UAAU,CAAE,mDAAmD,CAC/DG,YAAY,CAAE,MAAM,CACpBkC,UAAU,CAAE,KAAK,CACjBC,UAAU,CAAE,eAAe,CAC3BZ,WAAW,CAAE,MAAM,CACnBa,SAAS,CAAE,qCACb,CAAE,CAAAxC,QAAA,CAAC,aAAM,CAAM,CAAC,cAChBhJ,IAAA,OAAI4I,KAAK,CAAE,CACTS,QAAQ,CAAE,QAAQ,CAClBiC,UAAU,CAAE,KAAK,CACjBrC,UAAU,CAAE,uFAAuF,CACnGwC,oBAAoB,CAAE,MAAM,CAC5BC,mBAAmB,CAAE,aAAa,CAClCC,cAAc,CAAE,WAAW,CAC3BC,SAAS,CAAE,iCACb,CAAE,CAAA5C,QAAA,CAAC,UAAQ,CAAI,CAAC,EACb,CAAC,cAEN9I,KAAA,QAAK0I,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAM,CAAEgD,MAAM,CAAE,OAAO,CAAE5C,UAAU,CAAE,2BAA2B,CAAEG,YAAY,CAAE,MAAM,CAAE0C,QAAQ,CAAE,QAAS,CAAE,CAAA9C,QAAA,eAElI9I,KAAA,QAAK0I,KAAK,CAAE,CAAE6B,KAAK,CAAE,OAAO,CAAEsB,WAAW,CAAE,gBAAgB,CAAED,QAAQ,CAAE,MAAO,CAAE,CAAA9C,QAAA,eAC9E9I,KAAA,QAAK0I,KAAK,CAAE,CAAEO,OAAO,CAAE,MAAM,CAAE6C,YAAY,CAAE,gBAAiB,CAAE,CAAAhD,QAAA,eAC9DhJ,IAAA,OAAI4I,KAAK,CAAE,CAAEG,YAAY,CAAE,MAAO,CAAE,CAAAC,QAAA,CAAC,eAAa,CAAI,CAAC,cACvDhJ,IAAA,UACE8E,IAAI,CAAC,MAAM,CACXmH,WAAW,CAAC,iBAAiB,CAC7B/F,KAAK,CAAE5E,WAAY,CACnBkJ,QAAQ,CAAGlG,CAAC,EAAK/C,cAAc,CAAC+C,CAAC,CAACI,MAAM,CAACwB,KAAK,CAAE,CAChD0C,KAAK,CAAE,CACL6B,KAAK,CAAE,MAAM,CACbtB,OAAO,CAAE,QAAQ,CACjBG,MAAM,CAAE,gBAAgB,CACxBF,YAAY,CAAE,KAAK,CACnBC,QAAQ,CAAE,QACZ,CAAE,CACH,CAAC,EACC,CAAC,CACL/I,aAAa,CAAC2E,GAAG,CAACiH,IAAI,OAAAC,qBAAA,oBACrBjM,KAAA,QAEEwK,OAAO,CAAEA,CAAA,GAAMjK,uBAAuB,CAACyL,IAAI,CAAE,CAC7CtD,KAAK,CAAE,CACLO,OAAO,CAAE,MAAM,CACf6C,YAAY,CAAE,mBAAmB,CACjCI,MAAM,CAAE,SAAS,CACjBnD,UAAU,CAAE,CAAAzI,oBAAoB,SAApBA,oBAAoB,iBAApBA,oBAAoB,CAAE8B,EAAE,IAAK4J,IAAI,CAAC5J,EAAE,CAAG,SAAS,CAAG,aAAa,CAC5EmF,QAAQ,CAAE,UACZ,CAAE,CAAAuB,QAAA,eAEF9I,KAAA,QAAK0I,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAM,CAAEC,cAAc,CAAE,eAAe,CAAEqC,UAAU,CAAE,QAAS,CAAE,CAAAnC,QAAA,eACrFhJ,IAAA,QAAK4I,KAAK,CAAE,CAAE0C,UAAU,CAAEY,IAAI,CAACG,YAAY,CAAG,CAAC,CAAG,MAAM,CAAG,QAAS,CAAE,CAAArD,QAAA,CACnEkD,IAAI,CAACI,UAAU,CAACC,QAAQ,CACtB,CAAC,CACLL,IAAI,CAACG,YAAY,CAAG,CAAC,eACpBrM,IAAA,SAAM4I,KAAK,CAAE,CACX4D,eAAe,CAAE,SAAS,CAC1BtD,KAAK,CAAE,OAAO,CACdE,YAAY,CAAE,KAAK,CACnBqB,KAAK,CAAE,MAAM,CACboB,MAAM,CAAE,MAAM,CACdhD,OAAO,CAAE,MAAM,CACfsC,UAAU,CAAE,QAAQ,CACpBrC,cAAc,CAAE,QAAQ,CACxBO,QAAQ,CAAE,QAAQ,CAClBiC,UAAU,CAAE,MACd,CAAE,CAAAtC,QAAA,CACCkD,IAAI,CAACG,YAAY,CACd,CACP,EACE,CAAC,CACLH,IAAI,CAACO,IAAI,eAAIvM,KAAA,QAAK0I,KAAK,CAAE,CAAES,QAAQ,CAAE,QAAQ,CAAEH,KAAK,CAAE,MAAO,CAAE,CAAAF,QAAA,EAAC,SAAO,CAACkD,IAAI,CAACO,IAAI,CAACpC,IAAI,EAAM,CAAC,CAC7F6B,IAAI,CAACQ,YAAY,eAChBxM,KAAA,QAAK0I,KAAK,CAAE,CACVS,QAAQ,CAAE,QAAQ,CAClBH,KAAK,CAAEgD,IAAI,CAACG,YAAY,CAAG,CAAC,CAAG,MAAM,CAAG,MAAM,CAC9C7C,SAAS,CAAE,SAAS,CACpB8B,UAAU,CAAEY,IAAI,CAACG,YAAY,CAAG,CAAC,CAAG,KAAK,CAAG,QAC9C,CAAE,CAAArD,QAAA,GAAAmD,qBAAA,CACCD,IAAI,CAACQ,YAAY,CAACxF,OAAO,UAAAiF,qBAAA,iBAAzBA,qBAAA,CAA2BQ,SAAS,CAAC,CAAC,CAAE,EAAE,CAAC,CAAC,KAC/C,EAAK,CACN,GAzCIT,IAAI,CAAC5J,EA0CP,CAAC,EACP,CAAC,EACC,CAAC,cAGNtC,IAAA,QAAK4I,KAAK,CAAE,CAAEgE,IAAI,CAAE,CAAC,CAAE/D,OAAO,CAAE,MAAM,CAAEgE,aAAa,CAAE,QAAS,CAAE,CAAA7D,QAAA,CAC/DxI,oBAAoB,cACnBN,KAAA,CAAAE,SAAA,EAAA4I,QAAA,eAEE9I,KAAA,QAAK0I,KAAK,CAAE,CAAEO,OAAO,CAAE,MAAM,CAAE6C,YAAY,CAAE,gBAAgB,CAAE/C,UAAU,CAAE,SAAU,CAAE,CAAAD,QAAA,eACrF9I,KAAA,QAAK0I,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAM,CAAEC,cAAc,CAAE,eAAe,CAAEqC,UAAU,CAAE,QAAS,CAAE,CAAAnC,QAAA,eACrF9I,KAAA,QAAA8I,QAAA,eACE9I,KAAA,QAAK0I,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAM,CAAEsC,UAAU,CAAE,QAAQ,CAAE2B,GAAG,CAAE,QAAS,CAAE,CAAA9D,QAAA,eACnEhJ,IAAA,OAAAgJ,QAAA,CAAKxI,oBAAoB,CAAC8L,UAAU,CAACC,QAAQ,CAAK,CAAC,cACnDvM,IAAA,QAAK4I,KAAK,CAAE,CACV6B,KAAK,CAAE,KAAK,CACZoB,MAAM,CAAE,KAAK,CACbzC,YAAY,CAAE,KAAK,CACnBH,UAAU,CAAE,SAAS,CACrB2C,SAAS,CAAE,mBACb,CAAE,CAAM,CAAC,EACN,CAAC,CACLpL,oBAAoB,CAACiM,IAAI,eACxBvM,KAAA,UAAA8I,QAAA,EAAO,cAAY,CAACxI,oBAAoB,CAACiM,IAAI,CAACpC,IAAI,EAAQ,CAC3D,EACE,CAAC,cACNrK,IAAA,WACE0K,OAAO,CAAEA,CAAA,GAAMvJ,uBAAuB,CAAC,IAAI,CAAE,CAC7CyH,KAAK,CAAE,CACLK,UAAU,CAAE,SAAS,CACrBC,KAAK,CAAE,OAAO,CACdI,MAAM,CAAE,MAAM,CACdH,OAAO,CAAE,aAAa,CACtBC,YAAY,CAAE,KAAK,CACnBgD,MAAM,CAAE,SAAS,CACjB/C,QAAQ,CAAE,QACZ,CAAE,CAAAL,QAAA,CACH,uBAED,CAAQ,CAAC,EACN,CAAC,CAGL5H,wBAAwB,CAAC6B,MAAM,CAAG,CAAC,eAClC/C,KAAA,QAAK0I,KAAK,CAAE,CAAEY,SAAS,CAAE,MAAM,CAAEL,OAAO,CAAE,SAAS,CAAEF,UAAU,CAAE,SAAS,CAAEG,YAAY,CAAE,KAAM,CAAE,CAAAJ,QAAA,eAChGhJ,IAAA,QAAK4I,KAAK,CAAE,CAAES,QAAQ,CAAE,QAAQ,CAAEiC,UAAU,CAAE,MAAM,CAAEvC,YAAY,CAAE,QAAS,CAAE,CAAAC,QAAA,CAAC,eAAa,CAAK,CAAC,CAClG5H,wBAAwB,CAAC6D,GAAG,CAAC8H,GAAG,eAC/B7M,KAAA,QAEEwK,OAAO,CAAEA,CAAA,GAAM1G,MAAM,CAACoG,QAAQ,CAAC4C,IAAI,CAAG,eAAgB,CACtDpE,KAAK,CAAE,CACLC,OAAO,CAAE,MAAM,CACfC,cAAc,CAAE,eAAe,CAC/BqC,UAAU,CAAE,QAAQ,CACpBhC,OAAO,CAAE,QAAQ,CACjBF,UAAU,CAAE,OAAO,CACnBG,YAAY,CAAE,KAAK,CACnBL,YAAY,CAAE,SAAS,CACvBqD,MAAM,CAAE,SAAS,CACjB/C,QAAQ,CAAE,QACZ,CAAE,CAAAL,QAAA,eAEF9I,KAAA,SAAA8I,QAAA,EAAM,eAAG,CAAC,GAAI,CAAAU,IAAI,CAACqD,GAAG,CAACE,gBAAgB,CAAC,CAACC,kBAAkB,CAAC,CAAC,CAAC,MAAI,CAAC,GAAI,CAAAxD,IAAI,CAACqD,GAAG,CAACE,gBAAgB,CAAC,CAACrD,kBAAkB,CAAC,CAAC,EAAO,CAAC,cAC9H5J,IAAA,SAAM4I,KAAK,CAAE,CACXK,UAAU,CAAE8D,GAAG,CAACI,MAAM,GAAK,WAAW,CAAG,SAAS,CAAGJ,GAAG,CAACI,MAAM,GAAK,SAAS,CAAG,SAAS,CAAG,SAAS,CACrGjE,KAAK,CAAE,OAAO,CACdC,OAAO,CAAE,eAAe,CACxBC,YAAY,CAAE,MAAM,CACpBC,QAAQ,CAAE,QACZ,CAAE,CAAAL,QAAA,CACC+D,GAAG,CAACI,MAAM,CACP,CAAC,GAvBFJ,GAAG,CAACzK,EAwBN,CACN,CAAC,EACC,CACN,EACE,CAAC,cAGNpC,KAAA,QAAK0I,KAAK,CAAE,CAAEgE,IAAI,CAAE,CAAC,CAAEzD,OAAO,CAAE,MAAM,CAAE2C,QAAQ,CAAE,MAAO,CAAE,CAAA9C,QAAA,EACxDtI,QAAQ,CAACuE,GAAG,CAACkD,OAAO,eACnBnI,IAAA,CAACiI,aAAa,EAEZE,OAAO,CAAEA,OAAQ,CACjBC,KAAK,CAAED,OAAO,CAAC0C,SAAS,GAAKnC,IAAI,CAACC,KAAK,CAACxF,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,CAACd,EAAG,EAFpE6F,OAAO,CAAC7F,EAGd,CACF,CAAC,cACFtC,IAAA,QAAKoN,GAAG,CAAExL,cAAe,CAAE,CAAC,EACzB,CAAC,CAGLF,cAAc,CAACuB,MAAM,CAAG,CAAC,eACxB/C,KAAA,QAAK0I,KAAK,CAAE,CAAEO,OAAO,CAAE,MAAM,CAAEkE,SAAS,CAAE,gBAAgB,CAAEpE,UAAU,CAAE,SAAU,CAAE,CAAAD,QAAA,eAClFhJ,IAAA,QAAK4I,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAM,CAAEiE,GAAG,CAAE,QAAQ,CAAEQ,QAAQ,CAAE,MAAM,CAAEvE,YAAY,CAAE,QAAS,CAAE,CAAAC,QAAA,CACtFtH,cAAc,CAACuD,GAAG,CAAC2B,KAAK,eACvB1G,KAAA,QAAoB0I,KAAK,CAAE,CAAEnB,QAAQ,CAAE,UAAU,CAAEoB,OAAO,CAAE,cAAe,CAAE,CAAAG,QAAA,eAC3EhJ,IAAA,QACEkK,GAAG,CAAEtD,KAAK,CAACrB,OAAQ,CACnB4E,GAAG,CAAC,SAAS,CACbvB,KAAK,CAAE,CACL6B,KAAK,CAAE,MAAM,CACboB,MAAM,CAAE,MAAM,CACd0B,SAAS,CAAE,OAAO,CAClBnE,YAAY,CAAE,KAAK,CACnBE,MAAM,CAAE,mBACV,CAAE,CACH,CAAC,cACFtJ,IAAA,WACE0K,OAAO,CAAEA,CAAA,GAAMvE,WAAW,CAACS,KAAK,CAACtE,EAAE,CAAE,CACrCsG,KAAK,CAAE,CACLnB,QAAQ,CAAE,UAAU,CACpBsD,GAAG,CAAE,MAAM,CACXC,KAAK,CAAE,MAAM,CACbP,KAAK,CAAE,MAAM,CACboB,MAAM,CAAE,MAAM,CACdzC,YAAY,CAAE,KAAK,CACnBH,UAAU,CAAE,SAAS,CACrBC,KAAK,CAAE,OAAO,CACdI,MAAM,CAAE,MAAM,CACd8C,MAAM,CAAE,SAAS,CACjB/C,QAAQ,CAAE,MAAM,CAChBR,OAAO,CAAE,MAAM,CACfsC,UAAU,CAAE,QAAQ,CACpBrC,cAAc,CAAE,QAClB,CAAE,CAAAE,QAAA,CACH,QAED,CAAQ,CAAC,GAhCDpC,KAAK,CAACtE,EAiCX,CACN,CAAC,CACC,CAAC,cACNpC,KAAA,UAAO0I,KAAK,CAAE,CAAEM,KAAK,CAAE,MAAO,CAAE,CAAAF,QAAA,EAAEtH,cAAc,CAACuB,MAAM,CAAC,oBAAkB,EAAO,CAAC,EAC/E,CACN,CAGAnC,OAAO,eACNZ,KAAA,QAAK0I,KAAK,CAAE,CAAEO,OAAO,CAAE,aAAa,CAAEF,UAAU,CAAE,SAAS,CAAEoE,SAAS,CAAE,gBAAiB,CAAE,CAAArE,QAAA,eACzF9I,KAAA,UAAA8I,QAAA,EAAO,eAAa,CAAClI,OAAO,CAACoG,OAAO,EAAQ,CAAC,cAC7ClH,IAAA,WAAQ0K,OAAO,CAAEA,CAAA,GAAM3J,UAAU,CAAC,IAAI,CAAE,CAAC6H,KAAK,CAAE,CAAE4E,KAAK,CAAE,OAAO,CAAEvE,UAAU,CAAE,MAAM,CAAEK,MAAM,CAAE,MAAO,CAAE,CAAAN,QAAA,CAAC,QAAC,CAAQ,CAAC,EAC/G,CACN,cAGD9I,KAAA,SAAMuN,QAAQ,CAAEnH,WAAY,CAACsC,KAAK,CAAE,CAAEO,OAAO,CAAE,MAAM,CAAEkE,SAAS,CAAE,gBAAgB,CAAExE,OAAO,CAAE,MAAM,CAAEiE,GAAG,CAAE,QAAS,CAAE,CAAA9D,QAAA,eACnHhJ,IAAA,UACE8E,IAAI,CAAC,MAAM,CACXsI,GAAG,CAAEvL,YAAa,CAClB6L,MAAM,CAAC,SAAS,CAChBC,QAAQ,MACRnD,QAAQ,CAAEnG,iBAAkB,CAC5BuE,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAO,CAAE,CAC5B,CAAC,cACF7I,IAAA,WAAQ8E,IAAI,CAAC,QAAQ,CAAC4F,OAAO,CAAEA,CAAA,QAAAkD,qBAAA,QAAAA,qBAAA,CAAM/L,YAAY,CAACgB,OAAO,UAAA+K,qBAAA,iBAApBA,qBAAA,CAAsBC,KAAK,CAAC,CAAC,EAAC,CAACjF,KAAK,CAAE,CAAEO,OAAO,CAAE,QAAQ,CAAEF,UAAU,CAAE,MAAM,CAAEK,MAAM,CAAE,MAAM,CAAE8C,MAAM,CAAE,SAAS,CAAE/C,QAAQ,CAAE,QAAS,CAAE,CAAAL,QAAA,CAAC,cAAE,CAAQ,CAAC,cACxLhJ,IAAA,WAAQ8E,IAAI,CAAC,QAAQ,CAAC4F,OAAO,CAAErD,aAAc,CAACuB,KAAK,CAAE,CAAEO,OAAO,CAAE,QAAS,CAAE,CAAAH,QAAA,CAAC,cAAE,CAAQ,CAAC,cACvFhJ,IAAA,UACE8E,IAAI,CAAC,MAAM,CACXoB,KAAK,CAAEtF,UAAW,CAClB4J,QAAQ,CAAGlG,CAAC,EAAKzD,aAAa,CAACyD,CAAC,CAACI,MAAM,CAACwB,KAAK,CAAE,CAC/C+F,WAAW,CAAC,mBAAmB,CAC/BrD,KAAK,CAAE,CAAEgE,IAAI,CAAE,CAAC,CAAEzD,OAAO,CAAE,SAAS,CAAEG,MAAM,CAAE,gBAAgB,CAAEF,YAAY,CAAE,MAAO,CAAE,CACxF,CAAC,cACFpJ,IAAA,WACE8E,IAAI,CAAC,QAAQ,CACbgJ,QAAQ,CAAEtM,OAAO,EAAK,CAACZ,UAAU,CAAC4F,IAAI,CAAC,CAAC,EAAI9E,cAAc,CAACuB,MAAM,GAAK,CAAG,CACzE2F,KAAK,CAAE,CACLO,OAAO,CAAE,aAAa,CACtBF,UAAU,CAAEzH,OAAO,CAAG,SAAS,CAAI,CAACZ,UAAU,CAAC4F,IAAI,CAAC,CAAC,EAAI9E,cAAc,CAACuB,MAAM,GAAK,CAAC,CAAI,MAAM,CAAG,SAAS,CAC1GiG,KAAK,CAAE,OAAO,CACdI,MAAM,CAAE,MAAM,CACdF,YAAY,CAAE,MAAM,CACpBgD,MAAM,CAAG5K,OAAO,EAAK,CAACZ,UAAU,CAAC4F,IAAI,CAAC,CAAC,EAAI9E,cAAc,CAACuB,MAAM,GAAK,CAAE,CAAI,aAAa,CAAG,SAAS,CACpGsG,OAAO,CAAG/H,OAAO,EAAK,CAACZ,UAAU,CAAC4F,IAAI,CAAC,CAAC,EAAI9E,cAAc,CAACuB,MAAM,GAAK,CAAE,CAAI,GAAG,CAAG,CAAC,CACnF4F,OAAO,CAAE,MAAM,CACfsC,UAAU,CAAE,QAAQ,CACpB2B,GAAG,CAAE,SACP,CAAE,CAAA9D,QAAA,CAEDxH,OAAO,CAAG,YAAY,cACrBtB,KAAA,CAAAE,SAAA,EAAA4I,QAAA,EAAE,MAEA,CAACtH,cAAc,CAACuB,MAAM,CAAG,CAAC,eACxB/C,KAAA,SAAM0I,KAAK,CAAE,CACXK,UAAU,CAAE,uBAAuB,CACnCG,YAAY,CAAE,MAAM,CACpBD,OAAO,CAAE,eAAe,CACxBE,QAAQ,CAAE,QACZ,CAAE,CAAAL,QAAA,EAAC,GACA,CAACtH,cAAc,CAACuB,MAAM,EACnB,CACP,EACD,CACH,CACK,CAAC,EACL,CAAC,EACP,CAAC,cAEHjD,IAAA,QAAK4I,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAM,CAAEsC,UAAU,CAAE,QAAQ,CAAErC,cAAc,CAAE,QAAQ,CAAE+C,MAAM,CAAE,MAAO,CAAE,CAAA7C,QAAA,cAC9FhJ,IAAA,MAAAgJ,QAAA,CAAG,0CAAwC,CAAG,CAAC,CAC5C,CACN,CACE,CAAC,EACH,CAAC,cAENhJ,IAAA,UAAOD,GAAG,MAAAiJ,QAAA,CAAE;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,CAAQ,CAAC,CAGT9H,oBAAoB,eACnBlB,IAAA,QAAK4I,KAAK,CAAE,CACVnB,QAAQ,CAAE,OAAO,CACjBsD,GAAG,CAAE,CAAC,CACNgD,IAAI,CAAE,CAAC,CACP/C,KAAK,CAAE,CAAC,CACRgD,MAAM,CAAE,CAAC,CACTxB,eAAe,CAAE,oBAAoB,CACrC3D,OAAO,CAAE,MAAM,CACfC,cAAc,CAAE,QAAQ,CACxBqC,UAAU,CAAE,QAAQ,CACpB8C,MAAM,CAAE,IACV,CAAE,CAAAjF,QAAA,cACA9I,KAAA,QAAK0I,KAAK,CAAE,CACVK,UAAU,CAAE,2BAA2B,CACvCiF,cAAc,CAAE,YAAY,CAC5B9E,YAAY,CAAE,MAAM,CACpBoC,SAAS,CAAE,6BAA6B,CACxClC,MAAM,CAAE,oCAAoC,CAC5CH,OAAO,CAAE,MAAM,CACfU,QAAQ,CAAE,OAAO,CACjBY,KAAK,CAAE,KACT,CAAE,CAAAzB,QAAA,eACAhJ,IAAA,OAAI4I,KAAK,CAAE,CAAEG,YAAY,CAAE,MAAO,CAAE,CAAAC,QAAA,CAAC,sBAAoB,CAAI,CAAC,cAC9D9I,KAAA,SAAMuN,QAAQ,CAAGnJ,CAAC,EAAK,CACrBA,CAAC,CAACiC,cAAc,CAAC,CAAC,CAClB,KAAM,CAAA4H,QAAQ,CAAG,GAAI,CAAAzH,QAAQ,CAACpC,CAAC,CAACI,MAAM,CAAC,CACvCP,iBAAiB,CAAC,CAChB8I,gBAAgB,CAAEkB,QAAQ,CAAC3K,GAAG,CAAC,kBAAkB,CAAC,CAClD4G,QAAQ,CAAE+D,QAAQ,CAAC3K,GAAG,CAAC,UAAU,CAAC,CAClC4K,KAAK,CAAED,QAAQ,CAAC3K,GAAG,CAAC,OAAO,CAC7B,CAAC,CAAC,CACJ,CAAE,CAAAwF,QAAA,eACA9I,KAAA,QAAK0I,KAAK,CAAE,CAAEG,YAAY,CAAE,MAAO,CAAE,CAAAC,QAAA,eACnChJ,IAAA,UAAO4I,KAAK,CAAE,CAAEC,OAAO,CAAE,OAAO,CAAEE,YAAY,CAAE,QAAS,CAAE,CAAAC,QAAA,CAAC,cAAY,CAAO,CAAC,cAChFhJ,IAAA,UACE8E,IAAI,CAAC,gBAAgB,CACrBuF,IAAI,CAAC,kBAAkB,CACvBgE,GAAG,CAAE,GAAI,CAAA3E,IAAI,CAAC,CAAC,CAAC4E,WAAW,CAAC,CAAC,CAACC,KAAK,CAAC,CAAC,CAAE,EAAE,CAAE,CAC3C3F,KAAK,CAAE,CAAE6B,KAAK,CAAE,MAAM,CAAEtB,OAAO,CAAE,QAAQ,CAAEC,YAAY,CAAE,KAAK,CAAEE,MAAM,CAAE,gBAAiB,CAAE,CAC3FkF,QAAQ,MACT,CAAC,EACC,CAAC,cACNtO,KAAA,QAAK0I,KAAK,CAAE,CAAEG,YAAY,CAAE,MAAO,CAAE,CAAAC,QAAA,eACnChJ,IAAA,UAAO4I,KAAK,CAAE,CAAEC,OAAO,CAAE,OAAO,CAAEE,YAAY,CAAE,QAAS,CAAE,CAAAC,QAAA,CAAC,WAAS,CAAO,CAAC,cAC7EhJ,IAAA,UACE8E,IAAI,CAAC,MAAM,CACXuF,IAAI,CAAC,UAAU,CACf4B,WAAW,CAAC,kBAAkB,CAC9BrD,KAAK,CAAE,CAAE6B,KAAK,CAAE,MAAM,CAAEtB,OAAO,CAAE,QAAQ,CAAEC,YAAY,CAAE,KAAK,CAAEE,MAAM,CAAE,gBAAiB,CAAE,CAC3FkF,QAAQ,MACT,CAAC,EACC,CAAC,cACNtO,KAAA,QAAK0I,KAAK,CAAE,CAAEG,YAAY,CAAE,MAAO,CAAE,CAAAC,QAAA,eACnChJ,IAAA,UAAO4I,KAAK,CAAE,CAAEC,OAAO,CAAE,OAAO,CAAEE,YAAY,CAAE,QAAS,CAAE,CAAAC,QAAA,CAAC,QAAM,CAAO,CAAC,cAC1EhJ,IAAA,aACEqK,IAAI,CAAC,OAAO,CACZ4B,WAAW,CAAC,qBAAqB,CACjCwC,IAAI,CAAC,GAAG,CACR7F,KAAK,CAAE,CAAE6B,KAAK,CAAE,MAAM,CAAEtB,OAAO,CAAE,QAAQ,CAAEC,YAAY,CAAE,KAAK,CAAEE,MAAM,CAAE,gBAAiB,CAAE,CAC5F,CAAC,EACC,CAAC,cACNpJ,KAAA,QAAK0I,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAM,CAAEiE,GAAG,CAAE,MAAO,CAAE,CAAA9D,QAAA,eAC3ChJ,IAAA,WACE8E,IAAI,CAAC,QAAQ,CACb4F,OAAO,CAAEA,CAAA,GAAMvJ,uBAAuB,CAAC,KAAK,CAAE,CAC9CyH,KAAK,CAAE,CAAEgE,IAAI,CAAE,CAAC,CAAEzD,OAAO,CAAE,SAAS,CAAEF,UAAU,CAAE,SAAS,CAAEC,KAAK,CAAE,OAAO,CAAEI,MAAM,CAAE,MAAM,CAAEF,YAAY,CAAE,KAAM,CAAE,CAAAJ,QAAA,CACpH,QAED,CAAQ,CAAC,cACThJ,IAAA,WACE8E,IAAI,CAAC,QAAQ,CACb8D,KAAK,CAAE,CAAEgE,IAAI,CAAE,CAAC,CAAEzD,OAAO,CAAE,SAAS,CAAEF,UAAU,CAAE,SAAS,CAAEC,KAAK,CAAE,OAAO,CAAEI,MAAM,CAAE,MAAM,CAAEF,YAAY,CAAE,KAAM,CAAE,CAAAJ,QAAA,CACpH,oBAED,CAAQ,CAAC,EACN,CAAC,EACF,CAAC,EACJ,CAAC,CACH,CACN,EACE,CAAC,CAEV,CAAC,CAED,cAAe,CAAA3I,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}